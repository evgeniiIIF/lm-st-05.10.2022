!function(t){var e=this,n=function(t){this.j=t},r=function(){n.apply(this,arguments)},i=function(){r.apply(this,arguments)},a=function(){r.apply(this,arguments)},o=function(){r.apply(this,arguments)},u=function(){n.apply(this,arguments)},s=function(){r.apply(this,arguments)},c=function(){r.apply(this,arguments)},E=function(){r.apply(this,arguments)},l=function(){r.apply(this,arguments)},f=function(){r.apply(this,arguments)},d=function(){r.apply(this,arguments)},_=function(){r.apply(this,arguments)},A=function(){r.apply(this,arguments)},y=function(){r.apply(this,arguments)},T=function(){n.apply(this,arguments)},h=function(){r.apply(this,arguments)},p=function(){r.apply(this,arguments)},S=function(){r.apply(this,arguments)},R=function(){r.apply(this,arguments)},I=function(){r.apply(this,arguments)},N=function(){r.apply(this,arguments)},O=function(){r.apply(this,arguments)},v=function(){r.apply(this,arguments)},F=function(){n.apply(this,arguments)},m=function(){n.apply(this,arguments)},L=function(){n.apply(this,arguments)},w=function(){r.apply(this,arguments)},x=function(){r.apply(this,arguments)},j=function(){r.apply(this,arguments)},D=function(){r.apply(this,arguments)},C=function(){r.apply(this,arguments)},U=function(){r.apply(this,arguments)},k=function(){r.apply(this,arguments)},P=function(){r.apply(this,arguments)},b=function(){r.apply(this,arguments)},H=function(){r.apply(this,arguments)},M=function(){r.apply(this,arguments)},g=function(){r.apply(this,arguments)},B=function(){r.apply(this,arguments)},V=function(){r.apply(this,arguments)},K=function(){r.apply(this,arguments)},Y=function(){r.apply(this,arguments)},W=function(){r.apply(this,arguments)},Q=function(){r.apply(this,arguments)},q=function(){r.apply(this,arguments)},G=function(){r.apply(this,arguments)},J=function(){r.apply(this,arguments)},z=function(){r.apply(this,arguments)},X=function(){r.apply(this,arguments)},$=function(){r.apply(this,arguments)},Z=function(){r.apply(this,arguments)},tt=function(){r.apply(this,arguments)},et=function(){r.apply(this,arguments)},nt=function(){r.apply(this,arguments)},rt=function(){r.apply(this,arguments)},it=function(){r.apply(this,arguments)},at=function(){r.apply(this,arguments)},ot=function(){r.apply(this,arguments)},ut=function(){r.apply(this,arguments)},st=function(){r.apply(this,arguments)},ct=function(){r.apply(this,arguments)},Et=function(){r.apply(this,arguments)},lt=function(e){return t.Fw((0,t.A1a)(),e)},ft=function(t){this.token=t},dt=function(t){if(!(t=t.key||t.id))throw Error("Entity key is missing");return t},_t=function(e){return t.Fw(function(){if(Mr)return Mr();var e={};return(Mr=t.Zw("PersistentEntityStoreDb",{Mq:(e.EntityStore={jo:1},e.EntityAssociationStore={jo:2},e),Ax:!1,upgrade:function(e,n){n(1)&&t.yw(t.tw(e,"EntityStore",{keyPath:"key"}),"entityType","entityType"),n(2)&&(e=t.tw(e,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),t.yw(e,"byParentEntityKey","parentEntityKey"),t.yw(e,"byChildEntityKey","childEntityKey"))},version:3}))()}(),e)},At=function(e,n){n=void 0===n?{}:n,t.aw.call(this,t.K1a[e],Object.assign({},{name:"PESEncoderError",type:e},n)),this.type=e,this.level="WARNING",Object.setPrototypeOf(this,At.prototype)},yt=function(t){return new At("WRONG_DATA_TYPE",{GZ:t})},Tt=function(t){return t instanceof Error?new At("UNKNOWN_ENCODE_ERROR",{originalMessage:t.message}):new At("UNKNOWN_ENCODE_ERROR")},ht=function(t){return t instanceof Error?new At("UNKNOWN_DECODE_ERROR",{originalMessage:t.message}):new At("UNKNOWN_DECODE_ERROR")},pt=function(e,n){throw e=e instanceof At?e:n(e),t.pz(e),e},St=function(){},Rt=function(t,e,n){try{return t.B(e,n)}catch(t){pt(t,Tt)}},It=function(t){t=(new TextEncoder).encode(t).subarray(0,16);var e=new Uint8Array(16);return e.set(t),e},Nt=function(t){this.j=t},Ot=function(t,e){this.j=t,this.u=e,this.B={}},vt=function(t,e){t:{t=Bt(t.u,e.version);try{var n=t.u(e.data,e.key);break t}catch(t){pt(t,ht)}n=void 0}return n},Ft=function(t,e,n){return t.j.objectStore("EntityStore").get(e).then((function(e){if(e){if(n&&e.entityType!==n)throw Error("Incorrect entity type");return vt(t,e)}}))},mt=function(e,n,r){return r?(r=r.map((function(t){return Ft(e,t,n)})),t.mw.all(r)):e.j.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(n)).then((function(t){return t.map((function(t){return vt(e,t)}))}))},Lt=function(e,n,r){var i=dt(n),a=Bt(e.u,1),o=Object.assign({},n);return e.j.objectStore("EntityStore").get(i).then((function(t){if(t){if(t.entityType!==r)throw Error("Incorrect entity type");o.entityMetadata||(t=vt(e,t),o.entityMetadata=t.entityMetadata)}})).then((function(){var n={key:i,entityType:r,data:Rt(a,o,i),version:1};return t.mw.all([t.ww(e.j.objectStore("EntityStore"),n),Pt(e,o,r)])})).then((function(){return Ct(e,i,r),i}))},wt=function(e,n,r){return n=n.map((function(t){return Lt(e,t,r)})),t.mw.all(n)},xt=function(e,n,r){if(null!=r&&r.Mp){var i=new Set;return bt(e,n,i).then((function(){for(var n=[],r=t.t(i),a=r.next();!a.done;a=r.next())n.push(xt(e,a.value));return t.mw.all(n).then((function(){}))}))}var a=t.sH(n).entityType;return t.mw.all([e.j.objectStore("EntityStore").delete(n),kt(e,n)]).then((function(){Ct(e,n,a)}))},jt=function(e,n){return t.Bw(e.j.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(n)},(function(r){return t.mw.all([r.delete(),kt(e,r.jD())]).then((function(){return Ct(e,r.jD(),n),r.continue()}))}))},Dt=function(e,n,r,i){var a=Bt(e.u,1);return Ft(e,n,i).then((function(o){if(o){o=t.cH(o,r);var u={key:n,entityType:i,data:Rt(a,o,n),version:1};return t.mw.all([t.ww(e.j.objectStore("EntityStore"),u),Pt(e,o,i)])}})).then((function(){return Ct(e,n,i),n}))},Ct=function(t,e,n){var r=t.B[n];r||(r=new Set,t.B[n]=r),r.add(e)},Ut=function(e,n,r){var i=dt(n);if(r=function(e){var n=Yr[e];if(n)return n;t.qz(new t.aw("Entity model not found.",{entityType:e}))}(r),!r)return t.mw.resolve([]);r=new r(n),e=e.j.objectStore("EntityAssociationStore"),n=[];for(var a=(r=t.t(r.u())).next();!a.done;a=r.next())n.push(t.ww(e,{parentEntityKey:i,childEntityKey:a.value}));return t.mw.all(n).then((function(t){return t.map((function(t){return t[1]}))}))},kt=function(t,e){return t.j.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(e))},Pt=function(t,e,n){var r=dt(e);return kt(t,r).then((function(){return Ut(t,e,n)}))},bt=function(e,n,r){return r.has(n)?t.mw.resolve(void 0):(r.add(n),Ht(e,n).then((function(t){return e.j.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(n)).then((function(){return t}))})).then((function(n){for(var i=t.mw.resolve(void 0),a={},o=(n=t.t(n)).next();!o.done;a={FF:a.FF},o=n.next())a.FF=o.value,i=i.then(function(t){return function(){return bt(e,t.FF,r)}}(a));return i})).then((function(){})))},Ht=function(e,n){var r=e.j.objectStore("EntityAssociationStore");return r.index("byParentEntityKey").getAll(IDBKeyRange.only(n)).then((function(e){for(var n=[],i=(e=t.t(e)).next();!i.done;i=e.next())i=i.value,n.push(r.index("byChildEntityKey").getAll(i.childEntityKey));return t.mw.all(n)})).then((function(e){for(var n=[],r=(e=t.t(e)).next();!r.done;r=e.next())1===(r=r.value).length&&n.push(r[0].childEntityKey);return n}))},Mt=function(){},gt=function(){if(this.j={},this.j[0]=new Mt,!t.lu("aes_pes_encoder_killswitch")){var e=this.j;try{var n=t.bw(),r=It(n),i=new Nt(new t.uF(r),new t.tF(r))}catch(n){throw e=n instanceof Error?new At("KEY_CREATION_FAILED",{originalMessage:n.message}):new At("KEY_CREATION_FAILED"),t.pz(e),e}e[1]=i}},Bt=function(e,n){if(n=void 0===n?0:n,!(e=e.j[n]))throw n=new At("INVALID_ENCODER_VERSION",{GZ:n}),t.pz(n),n;return e},Vt=function(e,n){t.L.call(this),this.token=e,this.u=n,this.j=[],(e=new t.D.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+t.bw())).onmessage=this.B.bind(this),this.channel=e},Kt=function(e,n,r){var i,a,o,u;return t.A((function(s){return 1==s.j?t.x(s,_t(e.token),2):3!=s.j?(i=s.u,t.x(s,t.vw(i,["EntityStore","EntityAssociationStore"],n,(function(t){return a=new Ot(t,e.u),r(a)})),3)):(o=s.u,a&&(u=a.B,0<Object.keys(u).length&&(e.channel.postMessage(u),Jt(e,u))),s.return(o))}))},Yt=function(t,e){return t.j.push(e),function(){var n=t.j.indexOf(e);0<=n&&t.j.splice(n,1)}},Wt=function(t,e,n){return Kt(t,{mode:"readwrite",dc:!0},(function(t){return Lt(t,e,n)}))},Qt=function(t,e){return Kt(t,{mode:"readwrite",dc:!0},(function(t){return wt(t,e,"offlineOrchestrationActionWrapperEntity")}))},qt=function(t,e,n){return Kt(t,{mode:"readonly",dc:!0},(function(t){return Ft(t,e,n)}))},Gt=function(t,e,n){return Kt(t,{mode:"readonly",dc:!0},(function(t){return mt(t,e,n)}))},Jt=function(e,n){for(var r=(e=t.t(e.j)).next();!r.done;r=e.next())(r=r.value)(n)},zt=function(){var e,n,r;return Wr||(Wr=t.A((function(i){return 1==i.j?(t.pa(i,2),t.x(i,t.Lw(),4)):2!=i.j?(e=i.u)&&t.cw()&&void 0!==t.D.BroadcastChannel?(n=new gt,i.return(new Vt(e,n))):i.return():((r=t.ta(i))instanceof Error&&t.pz(r),i.return())}))),Wr},Xt=function(t){var e;return"ENTITY_PERSISTENCE_OPTION_PERSIST"===(t=null==(e=t.options)?void 0:e.persistenceOption)||"ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"===t},$t=function(e){var n;return t.A((function(r){if(1==r.j){if(!(n=e.mutations)||0>=n.length)return r.return();if(t.$H){var i={type:"ENTITY_LOADED"};void 0!==n&&(i.payload=n),t.$H.dispatch(i)}return t.x(r,function(e){var n;return t.A((function(r){return 1==r.j?t.x(r,zt(),2):(n=r.u)?t.x(r,Kt(n,"readwrite",(function(n){for(var r={},i={},a=t.t(e),o=a.next();!o.done;i={Rh:i.Rh,Ju:i.Ju},o=a.next())i.Rh=o.value,i.Rh.entityKey&&Xt(i.Rh)&&(i.Ju=t.tf(i.Rh.payload),o=void 0,"ENTITY_MUTATION_TYPE_REPLACE"===i.Rh.type&&(o=function(t){return function(){return Lt(n,t.Rh.payload[t.Ju],t.Ju)}}(i)),"ENTITY_MUTATION_TYPE_DELETE"===i.Rh.type&&(o=function(t){return function(){return xt(n,t.Rh.entityKey)}}(i)),"ENTITY_MUTATION_TYPE_UPDATE"===i.Rh.type&&(o=function(t){return function(){return Dt(n,t.Rh.entityKey,t.Rh.payload[t.Ju],t.Ju)}}(i)),o&&(r[i.Rh.entityKey]=r[i.Rh.entityKey]?r[i.Rh.entityKey].then(o):o()));return t.mw.all(Object.values(r))})),0):r.return()}))}(n),2)}n.length=0,t.oa(r)}))},Zt=function(t){return void 0!==t},te=function(){var e,n;return t.A((function(r){if(1==r.j)return t.x(r,t.Lw(),2);if(3!=r.j){if(!(e=r.u))throw t.kw("rvdfd");return t.x(r,t.AH(e),3)}return n=r.u,r.return(t.vw(n,["index","media"],{mode:"readwrite",dc:!0},(function(e){var n={};return t.zw(e.objectStore("index"),{},(function(e){var r=e.getKey().match(/^([\w\-_]+)\|(a|v)$/),i=t.mw.resolve(void 0);if(r){var a,o=r[1];r=r[2],n[o]=n[o]||{},n[o][r]=t.CH(null==(a=e.getValue())?void 0:a.fmts)}else i=e.delete().then((function(){}));return t.mw.all([e.continue(),i]).then((function(e){return t.t(e).next().value}))})).then((function(){for(var r={},i=t.t(Object.keys(n)),a=i.next();!a.done;a=i.next()){a=a.value;var o=n[a].v;r[a]=n[a].a&&o?1:2}var u=function(e){var n=t.xH();for(var r in n=Object.assign({},n),e=Object.assign({},e),n)e[r]?(4!==n[r]&&(n[r]=e[r]),delete e[r]):2!==n[r]&&(n[r]=4);return Object.assign(n,e),t.AAa(n),JSON.stringify(n),n}(r);return t.Ana(e.objectStore("media"),{},(function(n){var i=n.getKey().match(t.JAa);return i&&r[i[1]]||e.objectStore("media").delete(n.getKey()),n.continue()})).then((function(){return u}))}))})))}))},ee=function(e){return t.A((function(n){return t.zH(e,0),n.return(function(e){var n,r;return t.A((function(i){return 1==i.j?t.x(i,t.Lw(),2):3!=i.j?(n=i.u)?t.x(i,t.AH(n),3):i.return():(r=i.u,i.return(t.vw(r,["index","media","captions"],{mode:"readwrite",dc:!0},(function(n){var r=IDBKeyRange.bound(e+"|",e+"~");return n=[n.objectStore("index").delete(r),n.objectStore("media").delete(r),n.objectStore("captions").delete(r)],t.mw.all(n).then((function(){}))}))))}))}(e))}))},ne=function(t,e,n){void 0===n?delete t[e.name]:t[e.name]=n},re=function(e,n,r){t.qz(new t.aw("Woffle: "+e,r?{cotn:r}:"")),n instanceof Error&&t.qz(n)},ie=function(e){var n,r,i,a,o,u,s,c,E,l,f,d,_,A,y,T,h;return t.A((function(p){if(1==p.j)return t.x(p,Kt(e,{mode:"readonly",dc:!0},(function(e){return mt(e,"playbackData").then((function(n){var r=n.map((function(t){return t.transfer})).filter((function(t){return!!t})),i=n.map((function(t){return t.offlineVideoPolicy})).filter((function(t){return!!t}));return r=mt(e,"transfer",r),i=mt(e,"offlineVideoPolicy",i),t.mw.all([r,i]).then((function(e){var r=t.t(e);return e=r.next().value,r=r.next().value,[n,e,r]}))}))})),2);for(n=p.u,r=t.t(n),i=r.next().value,a=r.next().value,o=r.next().value,u=i,s=a,c=o,E={},l={},f=t.t(s),d=f.next();!d.done;d=f.next())(_=d.value)&&(E[_.key]=_);for(A=t.t(c),y=A.next();!y.done;y=A.next())(T=y.value)&&(l[T.key]=T);return h=u.map((function(e){var n=E[e.transfer],r=l[e.offlineVideoPolicy];if(e=t.sH(r.key).entityId,"OFFLINE_VIDEO_POLICY_ACTION_DISABLE"===r.action){var i="OFFLINE_VIDEO_STATE_DISABLED";r.expirationTimestamp&&Number(r.expirationTimestamp)<Date.now()/1e3&&(i="OFFLINE_VIDEO_STATE_EXPIRED"),r=i}else if("OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED"===r.action)r="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(null==n?void 0:n.transferState){case"TRANSFER_STATE_TRANSFER_IN_QUEUE":i="OFFLINE_VIDEO_STATE_PENDING";break;case"TRANSFER_STATE_TRANSFERRING":i="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case"TRANSFER_STATE_PAUSED_BY_USER":i="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case"TRANSFER_STATE_FAILED":i="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case"TRANSFER_STATE_COMPLETE":i="OFFLINE_VIDEO_STATE_PLAYABLE";break;case"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":i="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:i="OFFLINE_VIDEO_STATE_UNKNOWN"}if("OFFLINE_VIDEO_STATE_OFFLINE_FAILED"===i)switch(null==n?void 0:n.failureReason){case"TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":i="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case"TRANSFER_FAILURE_REASON_STREAM_MISSING":i="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case"TRANSFER_FAILURE_REASON_NETWORK":case"TRANSFER_FAILURE_REASON_NETWORK_LOST":i="OFFLINE_VIDEO_STATE_NETWORK_ERROR"}r=i}return e={id:e,videoState:r},null!=n&&n.cotn&&(e.cotn=n.cotn),null!=n&&n.maximumDownloadQuality&&(e.selectedVideoQuality=null==n?void 0:n.maximumDownloadQuality),e})),p.return({offlineVideos:h})}))},ae=function(e){t.L.call(this),this.api=e,void 0!==t.D.BroadcastChannel&&(this.j=new t.D.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+t.bw()),this.j.onmessage=this.B.bind(this),this.u=new t.D.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+t.bw()),this.u.onmessage=this.C.bind(this))},oe=function(t,e){var n;t.api.Pa("onOfflineOperationFailure",e),null==(n=t.j)||n.postMessage(e)},ue=function(){this.locks=navigator.locks},se=function(e,n,r,i){var a=this;this.S=e,this.Z=n,this.visibility=r,this.N=i,this.C=this.I=this.F=this.u=this.j=!1,this.J=new t.eo((function(){le(a)})),this.visibility.subscribe("visibilitystatechange",(function(){a.Hf()}))},ce=function(e){if(!e.u&&!e.j){var n=function(){try{var e,n=t.Ia("ytglobal.locks_");if(n)return n;if(e=navigator){var r=navigator;e="locks"in r&&!!r.locks}if(e)return t.D.localStorage&&t.D.localStorage.getItem("noop"),n=new ue,t.Ha("ytglobal.locks_",n),n}catch(t){}}();if(n){e.u=!0;var r=t.bw("OfflineLockManager");n.request("woffle_orchestration_leader:"+r,{},(function(){var n,r,i,a;return t.A((function(o){switch(o.j){case 1:return t.pa(o,2),e.B=new t.$i,e.j=!0,e.u=!1,t.x(o,e.S(),4);case 4:return t.x(o,e.B.promise,5);case 5:t.ra(o,0);break;case 2:n=t.ta(o),(null==(i=(r=e).N)?0:i.call(r,"wo_relinquish_leadership_on_lock_request_error"))||le(e),n instanceof Error&&((a=n).args=[{name:"WoLockManagerError",oE:n.name}],t.pz(a)),t.oa(o)}}))}))}}},Ee=function(e){e.I&&e.F&&e.C&&e.visibility.isBackground()?t.fo(e.J,6e4):e.J.stop()},le=function(t){t.B&&t.B.resolve(),t.j=!1,t.u=!1,t.Z()},fe=function(e,n){var r,i,a=n.Wj;e.encryptedVideoId=n.videoId,e.cotn=null==a?void 0:a.cotn,e.offlineabilityFormatType=null==a?void 0:a.maximumDownloadQuality,e.isRefresh=null!=(r=null==a?void 0:a.isRefresh)&&r,e.softErrorCount=null!=(i=null==a?void 0:a.transferRetryCount)?i:0,t.Wv("offlineTransferStatusChanged",e)},de=function(t,e,n,r){r={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",statusType:"OFFLINING_STARTED",transferFirstStarted:!!r},e&&n&&(e=Math.floor(e/1024).toFixed(),n=Math.floor(n/1024).toFixed(),r.alreadyDownloadedKbytes=e,r.totalFetchedKbytes=e,r.totalContentKbytes=n),fe(r,t)},_e=function(t){fe({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",statusType:"SUSPENDED"},t)},Ae=function(){},ye=function(){},Te=function(e){if(e.includes(":"))throw Error("Invalid user cache name: "+e);return e+":"+t.bw("CacheStorage get")},he=function(){return t.A((function(n){return 1==n.j?t.x(n,t.A((function(n){return void 0!==ii||(ii=new Promise((function(n){var r;return t.A((function(i){switch(i.j){case 1:return t.pa(i,2),t.x(i,oi.open("test-only"),4);case 4:return t.x(i,oi.delete("test-only"),5);case 5:t.ra(i,3);break;case 2:if((r=t.ta(i))instanceof Error&&"SecurityError"===r.name)return n(!1),i.return();case 3:n("caches"in e),t.oa(i)}}))}))),n.return(ii)})),2):n.u?(ai||(ai=new ye),n.return(ai)):n.return(void 0)}))},pe=function(){var e;return t.A((function(n){return 1==n.j?t.x(n,he(),2):(e=n.u)?n.return(e.delete("yt-player-local-img")):n.return(!0)}))},Se=function(e){var n,r;return t.A((function(i){if(1==i.j)return t.x(i,he(),2);if(3!=i.j){if(!(n=i.u))throw Error("Cache API not supported");return e.length?t.x(i,n.open("yt-player-local-img"),3):i.return()}return r=i.u,t.x(i,Promise.all(e.map((function(t){return r.delete(t)}))),0)}))},Re=function(e){var n,r;return t.A((function(i){if(1==i.j)return t.x(i,he(),2);if(3!=i.j){if(!(n=i.u))throw Error("Cache API not supported");return e.length?t.x(i,n.open("yt-player-local-img"),3):i.return()}return r=i.u,t.x(i,r.addAll(e),0)}))},Ie=function(t){var e,n,r;return 0<(null!=(r=null==(e=t.actionMetadata)||null==(n=e.retryScheduleIntervalsInSeconds)?void 0:n.length)?r:0)},Ne=function(t){return"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"===t.actionType&&!!t.entityKey},Oe=function(t){return"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"===t.actionType&&!!t.entityKey},ve=function(t){return"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"===t.actionType&&!!t.entityKey},Fe=function(e,n,r,i){var a,o,u,s,c,E,l,f,d,_,A,y,T,h,p,S,R,I,N,O,v,F,m,L,w,x,j,D;return t.A((function(C){switch(C.j){case 1:return a=t.tH(e,"ytMainVideoEntity"),o=t.tH(e,"mainVideoEntity"),u=t.tH(e,"ytMainChannelEntity"),s=t.tH(e,"transfer"),t.x(C,Kt(n,{mode:"readonly",dc:!0},(function(e){return t.mw.all([Ft(e,a,"ytMainVideoEntity"),Ft(e,o,"mainVideoEntity"),Ft(e,u,"ytMainChannelEntity"),Ft(e,s,"transfer"),mt(e,"ytMainChannelEntity"),mt(e,"offlineOrchestrationActionWrapperEntity")])})),2);case 2:if(c=C.u,E=t.t(c),l=E.next().value,f=E.next().value,d=E.next().value,_=E.next().value,A=E.next().value,y=E.next().value,h=f,p=d,S=_,R=A,I=y,!((T=l)||h||p)){C.Na(3);break}if(N=T?ke(T.thumbnail):h?ke(h.thumbnail):[],!p){O=[],C.Na(4);break}return t.x(C,Me(p,R),5);case 5:O=C.u;case 4:return v=O,t.x(C,Se(N.concat(v)),3);case 3:for(F=[],m=t.tH(e,"ytMainDownloadedVideoEntity"),L=t.tH(e,"mainVideoEntity"),w=t.tH(e,"downloadStatusEntity"),x=t.t(I),j=x.next();!j.done;j=x.next())D=j.value,t.sH(D.key).entityId!==e||Ce(r,D.actionProto)||F.push(D.key);return t.x(C,Kt(n,{mode:"readwrite",dc:!0},(function(e){var n=F.map((function(t){return xt(e,t)}));return n.push(xt(e,m,{Mp:!0})),n.push(xt(e,L,{Mp:!0})),n.push(xt(e,w,{Mp:!0})),t.mw.all(n)})),7);case 7:Ue(S),oe(i,{entityKey:m,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),oe(i,{entityKey:L,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),t.oa(C)}}))},me=function(e,n,r,i){var a,o,u,s,c,E,l,f,d,_,A,y,T,h,p,S,R,I,N,O,v,F,m,L,w,x,j,D,C;return t.A((function(U){switch(U.j){case 1:return a=t.tH(e,"mainPlaylistEntity"),o=t.tH(e,"ytMainChannelEntity"),t.x(U,Kt(n,{mode:"readonly",dc:!0},(function(e){return t.mw.all([Ft(e,a,"mainPlaylistEntity"),Ft(e,o,"ytMainChannelEntity"),mt(e,"mainPlaylistEntity"),mt(e,"ytMainChannelEntity"),mt(e,"offlineOrchestrationActionWrapperEntity")])})),2);case 2:if(u=U.u,s=t.t(u),c=s.next().value,E=s.next().value,l=s.next().value,f=s.next().value,d=s.next().value,A=E,y=l,T=f,h=d,!(_=c)&&!A){U.Na(3);break}if(p=_?Pe(_):[],!A){S=[],U.Na(4);break}return t.x(U,Me(A,T),5);case 5:S=U.u;case 4:return R=S,t.x(U,Se(p.concat(R)),3);case 3:if(!_){U.Na(7);break}return t.x(U,be(_,y),8);case 8:if(!(I=U.u)){U.Na(7);break}N=t.t(I),O=N.next();case 10:if(O.done){U.Na(7);break}if(v=O.value,F=JSON.parse(t.sH(v).entityId),m=F.videoId,L=F.playlistId,!m||L!==_.playlistId){U.Na(11);break}return t.x(U,Fe(m,n,r,i),11);case 11:O=N.next(),U.Na(10);break;case 7:for(w=[],x=t.t(h),j=x.next();!j.done;j=x.next())D=j.value,t.sH(D.key).entityId!==e||Ce(r,D.actionProto)||w.push(D.key);return C=t.tH(e,"mainPlaylistEntity"),t.x(U,Kt(n,{mode:"readwrite",dc:!0},(function(e){var n=w.map((function(t){return xt(e,t)}));return n.push(xt(e,C,{Mp:!0})),t.mw.all(n)})),0)}}))},Le=function(e,n,r){var i,a,o,u,s,c;return t.A((function(E){if(1==E.j)return t.x(E,Kt(e,{mode:"readwrite",dc:!0},(function(e){var r=mt(e,"transfer"),i=mt(e,"offlineOrchestrationActionWrapperEntity");return t.mw.all([r,i]).then((function(r){var i=(r=t.t(r)).next().value,a=r.next().value;r=ui.map((function(t){return jt(e,t)}));for(var o=(a=t.t(a)).next();!o.done;o=a.next()){o=o.value;var u=t.sH(o.actionProto.entityKey).entityType,s="ytMainDownloadedVideoEntity"===u;u="mainVideoEntity"===u;var c="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"===o.actionProto.actionType;Ce(n,o.actionProto)||s&&(!s||c)&&u&&(!u||c)||r.push(xt(e,o.key,{Mp:!0}))}return t.mw.all(r).then((function(){return i}))}))})),2);for(i=E.u,a=t.t(i),o=a.next();!o.done;o=a.next())u=o.value,Ue(u),s=t.sH(u.key).entityId,c=t.tH(s,"ytMainDownloadedVideoEntity"),oe(r,{entityKey:c,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return t.x(E,pe(),0)}))},we=function(e,n,r,i){var a,o,u,s,c,E,l,f,d,_,A,y,T,h,p,S,R,I;return t.A((function(N){switch(N.j){case 1:return a=t.tH(e,"musicTrack"),o=t.tH(e,"transfer"),t.x(N,Kt(n,{mode:"readonly",dc:!0},(function(e){return t.mw.all([Ft(e,a,"musicTrack"),Ft(e,o,"transfer"),mt(e,"musicTrack"),mt(e,"offlineOrchestrationActionWrapperEntity")])})),2);case 2:if(u=N.u,s=t.t(u),c=s.next().value,E=s.next().value,l=s.next().value,f=s.next().value,_=E,A=l,y=f,!(d=c)){N.Na(3);break}return t.x(N,ge(d,A),4);case 4:return T=N.u,t.x(N,Se(T),3);case 3:for(h=[],p=t.tH(e,"musicTrack"),S=t.t(y),R=S.next();!R.done;R=S.next())I=R.value,t.sH(I.key).entityId!==e||Ce(r,I.actionProto)||h.push(I.key);return t.x(N,Kt(n,{mode:"readwrite",dc:!0},(function(e){var n=h.map((function(t){return xt(e,t)}));return n.push(xt(e,p,{Mp:!0})),t.mw.all(n)})),6);case 6:Ue(_),oe(i,{entityKey:p,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),t.oa(N)}}))},xe=function(e,n,r,i){var a,o,u,s,c,E,l,f,d,_,A,y,T,h,p,S,R,I,N,O;return t.A((function(v){switch(v.j){case 1:return a=t.tH(e,"musicPlaylist"),t.x(v,Kt(n,{mode:"readonly",dc:!0},(function(e){return t.mw.all([Ft(e,a,"musicPlaylist"),mt(e,"musicPlaylist"),mt(e,"offlineOrchestrationActionWrapperEntity")])})),2);case 2:if(o=v.u,u=t.t(o),s=u.next().value,c=u.next().value,E=u.next().value,f=c,d=E,!(l=s)){v.Na(3);break}return t.x(v,ge(l,f),4);case 4:return _=v.u,t.x(v,Se(_),3);case 3:if(!l){v.Na(6);break}return t.x(v,He(l,f),7);case 7:if(!(A=v.u)){v.Na(6);break}y=t.t(A),T=y.next();case 9:if(T.done){v.Na(6);break}if(h=T.value,!(p=t.sH(h).entityId)){v.Na(10);break}return t.x(v,we(p,n,r,i),10);case 10:T=y.next(),v.Na(9);break;case 6:for(S=[],R=t.t(d),I=R.next();!I.done;I=R.next())N=I.value,t.sH(N.key).entityId!==e||Ce(r,N.actionProto)||S.push(N.key);return O=t.tH(e,"musicPlaylist"),t.x(v,Kt(n,{mode:"readwrite",dc:!0},(function(e){var n=S.map((function(t){return xt(e,t)}));return n.push(xt(e,O,{Mp:!0})),t.mw.all(n)})),0)}}))},je=function(e,n,r){var i,a,o,u,s,c;return t.A((function(E){if(1==E.j)return t.x(E,Kt(e,{mode:"readwrite",dc:!0},(function(e){var r=mt(e,"transfer"),i=mt(e,"offlineOrchestrationActionWrapperEntity");return t.mw.all([r,i]).then((function(r){var i=(r=t.t(r)).next().value,a=r.next().value;r=si.map((function(t){return jt(e,t)}));for(var o=(a=t.t(a)).next();!o.done;o=a.next()){o=o.value;var u="musicTrack"===t.sH(o.actionProto.entityKey).entityType,s="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"===o.actionProto.actionType;Ce(n,o.actionProto)||u&&(!u||s)||r.push(xt(e,o.key,{Mp:!0}))}return t.mw.all(r).then((function(){return i}))}))})),2);for(i=E.u,a=t.t(i),o=a.next();!o.done;o=a.next())u=o.value,Ue(u),s=t.sH(u.key).entityId,c=t.tH(s,"musicTrack"),oe(r,{entityKey:c,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return t.x(E,pe(),0)}))},De=function(e){for(var n,r=t.t(e.additionalMetadatas),i=r.next();!i.done;i=r.next())(i=i.value).offlineMusicVideoData&&(n=i.offlineMusicVideoData);var a,o,u,s,c;return{id:t.tH(e.videoId,"musicTrack"),videoId:e.videoId,title:e.title,thumbnailDetails:e.thumbnail,lengthMs:String(1e3*Number(e.lengthSeconds)),albumTitle:null==(a=n)?void 0:a.releaseTitle,musicVideoType:null==(o=n)?void 0:o.musicVideoType,contentRating:{explicitType:null==(u=n)?void 0:u.explicitType},artistNames:(null==(s=n)?void 0:s.byline)||(null==(c=n)?void 0:c.channelName),downloadMetadata:t.tH(e.videoId,"musicTrackDownloadMetadataEntity")}},Ce=function(t,e){return t.actionType===e.actionType&&t.entityKey===e.entityKey},Ue=function(e){if(e&&"TRANSFER_STATE_COMPLETE"!==e.transferState&&"TRANSFER_STATE_FAILED"!==e.transferState){var n=t.sH(e.key).entityId;fe({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:n,Wj:e})}},ke=function(e){if(!e||!e.thumbnails)return[];for(var n=[],r=(e=t.t(e.thumbnails)).next();!r.done;r=e.next())(r=r.value).url&&n.push(r.url);return n},Pe=function(e,n){var r=[];if(e.thumbnailStyleData)for(var i=(e=t.t(e.thumbnailStyleData)).next();!i.done;i=e.next()){var a,o=void 0,u=void 0;r=r.concat(ke(null==(a=i.value)||null==(o=a.value)||null==(u=o.collageThumbnail)?void 0:u.coverThumbnail))}return n=ke(n),r.concat(n)},be=function(e,n){var r,i,a,o,u,s,c,E,l,f,d,_;return t.A((function(A){if(r=[],e.videos){for(i=t.t(e.videos),a=i.next();!a.done;a=i.next())o=a.value,r.push(o);for(u=t.t(n),s=u.next();!s.done;s=u.next())if((c=s.value).key!==e.key&&(E=c.videos))for(l=t.t(E),f=l.next();!f.done;f=l.next())d=f.value,-1!==(_=r.indexOf(d))&&r.splice(_,1)}return A.return(r)}))},He=function(e,n){var r,i,a,o,u,s,c,E,l,f,d,_;return t.A((function(A){if(r=[],e.tracks){for(i=t.t(e.tracks),a=i.next();!a.done;a=i.next())o=a.value,r.push(o);for(u=t.t(n),s=u.next();!s.done;s=u.next())if((c=s.value).id!==e.id&&(E=c.tracks))for(l=t.t(E),f=l.next();!f.done;f=l.next())d=f.value,-1!==(_=r.indexOf(d))&&r.splice(_,1)}return A.return(r)}))},Me=function(e,n){var r,i,a,o,u,s,c,E;return t.A((function(l){for(r=ke(e.avatar),i=t.t(n),a=i.next();!a.done;a=i.next())if((o=a.value).id!==e.id)for(u=t.t(ke(o.avatar)),s=u.next();!s.done;s=u.next())c=s.value,-1!==(E=r.indexOf(c))&&r.splice(E,1);return l.return(r)}))},ge=function(e,n){var r,i,a,o,u,s,c,E;return t.A((function(l){for(r=ke(e.thumbnailDetails),i=t.t(n),a=i.next();!a.done;a=i.next())if((o=a.value).id!==e.id)for(u=t.t(ke(o.thumbnailDetails)),s=u.next();!s.done;s=u.next())c=s.value,-1!==(E=r.indexOf(c))&&r.splice(E,1);return l.return(r)}))},Be=function(e){var n;return t.A((function(r){return n=t.S(e.frameworkUpdates,Gr),e.frameworkUpdates&&n?t.x(r,$t(n),0):r.return()}))},Ve=function(e){var n,r;if(null!=(n=e.onResponseReceivedActions)&&n.length&&(null!=(e=null==(r=t.S(t.S(e.onResponseReceivedActions[0],qr),ti))?void 0:r.actions)&&e.length))return e},Ke=function(e){var n,r,i;return t.A((function(a){return 1==a.j?e?t.x(a,qt(e,t.Z1a,"mainDownloadsListEntity"),2):a.return([]):(n=a.u,null!=(r=n)&&(null!=(i=r.downloads)&&i.length)?a.return(n.downloads.map((function(t){var e;return null!=(e=t.videoItem)?e:""}))):a.return([]))}))},Ye=function(t){this.j=t},We=function(e,n,r,i,a,o){return{actionType:e,entityKey:n=t.tH(n,r),actionMetadata:i=Object.assign({},o,{priority:i,retryScheduleIntervalsInSeconds:a})}},Qe=function(t,e,n,r,i){this.status=t,this.j=e,this.C=n,this.u=r,this.B=i},qe=function(t,e,n){this.j=t,this.Y=e,this.B=n},Ge=function(e,n){var r,i,a,o,u,s,c,E,l;return t.A((function(f){switch(f.j){case 1:r=n.entityKey,a=null==(i=t.S(n.actionMetadata,ni))?void 0:i.isEnqueuedForExpiredStreamUrlRefetch,t.pa(f,2);var d=(d=t.S(n.actionMetadata,ni))?{maximumDownloadQuality:d.maximumDownloadQuality}:void 0;return t.x(f,Je(e,r,{isEnqueuedForExpiredStreamUrlRefetch:a,uU:d}),4);case 4:return(o=f.u)?t.x(f,ze(e,o,n),5):(u=Ie(n)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",f.return(Xe(n,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",u)));case 5:if(!e.Y.N("woffle_enable_download_status")){f.Na(6);break}return s=t.sH(n.entityKey).entityId,t.x(f,function(e,n){var r,i,a,o,u,s;return t.A((function(c){return 1==c.j?(r=t.tH(e,"mainVideoDownloadStateEntity"),i=t.tH(e,"downloadStatusEntity"),t.x(c,Kt(n,{mode:"readonly",dc:!0},(function(e){return t.mw.all([Ft(e,r,"mainVideoDownloadStateEntity"),Ft(e,i,"downloadStatusEntity")])})),2)):(a=c.u,(o=a.length?a[0]:void 0)?(u=Jr,(s=1<a.length?a[1]:void 0)?s.downloadState="DOWNLOAD_STATE_PENDING_DOWNLOAD":s={key:i,downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},ne(o,u,s),t.x(c,Kt(n,{mode:"readwrite",dc:!0},(function(e){var n=Lt(e,o,"mainVideoDownloadStateEntity");return e=Lt(e,s,"downloadStatusEntity"),t.mw.all([n,e])})),0)):c.Na(0))}))}(s,e.j),6);case 6:return f.return(Xe(n,!0,o.orchestrationActions));case 2:return c=t.ta(f),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof t.fw&&"QUOTA_EXCEEDED"===c.type&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),re("PDE handleAdd error"),f.return(Xe(n,!1,void 0,E,l))}}))},Je=function(e,n,r){var i,a,o;return t.A((function(u){return i=t.TM(),a=function(e,n,r,i,a){return e={entityKey:e},r&&(e.refreshData=r),i&&(e.isExpiredStreamUrlRefetch=i),a&&(e.downloadParameters=a),{context:t.vN(n),signatureTimestamp:19264,videos:[e]}}(n,e.Y,r.refreshData,r.isEnqueuedForExpiredStreamUrlRefetch,r.uU),o=t.EM(Kr),u.return(t.NK(i,a,o).then((function(t){return t})))}))},ze=function(e,n,r){var i;return t.A((function(a){return 1==a.j?n.frameworkUpdates&&n.frameworkUpdates.entityBatchUpdate?n.frameworkUpdates.entityBatchUpdate.mutations&&0<n.frameworkUpdates.entityBatchUpdate.mutations.length&&"ENTITY_MUTATION_TYPE_DELETE"===n.frameworkUpdates.entityBatchUpdate.mutations[0].type?(i=t.sH(n.frameworkUpdates.entityBatchUpdate.mutations[0].entityKey).entityId,t.x(a,Fe(i,e.j,r,e.B),2)):a.Na(2):a.return():t.x(a,$t(n.frameworkUpdates.entityBatchUpdate),0)}))},Xe=function(t,e,n,r,i){return new Qe(e?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Ie(t),n,r,i)},$e=function(){Ye.apply(this,arguments)},Ze=function(e,n,r){var i,a,o,u,s;return r=void 0!==r&&r,t.A((function(c){if(1==c.j)return i=t.S(n.actionMetadata,ri),u={key:n.entityKey,transferState:"TRANSFER_STATE_TRANSFER_IN_QUEUE",cotn:t.wz(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:null==(a=i)?void 0:a.maximumDownloadQuality,preferredAudioTrack:null==(o=i)?void 0:o.preferredAudioTrack,transferRetryCount:0,isRefresh:r,hasLoggedFirstStarted:!1},s=t.sH(u.key).entityId,t.x(c,Kt(e.j,{mode:"readwrite",dc:!0},(function(e){var n=[];return r&&n.push(xt(e,t.tH(s,"offlineVideoStreams"))),n.push(Lt(e,u,"transfer")),t.mw.all(n)})),2);fe({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:s,Wj:u}),t.oa(c)}))},tn=function(e,n,r){return new t.NH(e,{cotn:n,raw_player_response:r,download_media:!0,start:1/0,disable_watch_next:!0})},en=function(t,e,n,r,i,a,o,u,s,c,E){this.entityType=t,this.actionId=e,this.action=n,this.parentActionId=r,this.rootActionId=void 0===i?e:i,this.childActionIds=a,this.prereqActionId=o,this.postreqActionIds=u,this.hasChildActionFailed=c,this.retryScheduleIndex=0,this.j=E||Date.now(),this.retryScheduleIndex=s||0},nn=function(e){return{key:t.tH(e.actionId,"offlineOrchestrationActionWrapperEntity"),actionProto:e.action,parentActionId:e.parentActionId,rootActionId:e.rootActionId,childActionIds:e.childActionIds,prereqActionId:e.prereqActionId,postreqActionIds:e.postreqActionIds,retryScheduleIndex:e.retryScheduleIndex,hasChildActionFailed:e.hasChildActionFailed,enqueueTimeSec:(e.j/1e3).toFixed()}},rn=function(){this.j=new Map},an=function(){return ci||(ci=new rn),ci},on=function(t,e){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",flowEventType:t},metadata:e,statusCode:void 0,csn:void 0,can:void 0}},un=function(e,n,r){if(!r){var i=void 0!==i&&i;(r=e.j.get("FLOW_TYPE_OFFLINE_ORCHESTRATION"))&&!i||(r=t.wz(16),e.j.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",r))}e={flowNonce:r,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:n.eventType},n.metadata&&(e.flowMetadata=n.metadata),void 0!==n.statusCode&&(e.flowEventStatus=n.statusCode),n.csn&&(e.csn=n.csn),n.can&&(e.can=n.can),t.Wv("flowEvent",e,void 0)},sn=function(e,n,r,i){if(!e.action.entityKey)throw Error("entityKey is missing.");var a=t.sH(e.action.entityKey);return e={entityType:a.JZ,entityId:a.entityId,offlineOrchestrationActionType:e.action.actionType,orchestrationAction:{orchestrationActionId:e.actionId}},n&&(e.offlineOrchestrationActionResult=n.status,e.isRetryable=!r&&n.j,n.B&&(e.offlineOrchestrationFailureReason=cn(n.B,e.isRetryable))),i&&(e.additionalOrchestrationActions=i.map((function(t){return{orchestrationActionId:t.actionId}}))),e},cn=function(t,e){return"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"!==t||e?"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"===t&&e?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":t:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},En=function(t,e){var n={offlineOrchestrationContext:sn(t)};e=on(e,n),un(an(),e,t.rootActionId)},ln=function(t,e,n,r){e={offlineOrchestrationContext:sn(t,e,n,r=void 0===r?[]:r)},e=on(3,e),un(an(),e,t.rootActionId)},fn=function(){this.actions=[]},dn=function(e,n){for(var r=(n=t.t(n)).next();!r.done;r=n.next())r=r.value,En(r,1),e.actions.push(r);e.actions.sort(e.j)},_n=function(e,n){for(var r=(e=t.t(e.actions)).next();!r.done;r=e.next())if(r.value.actionId===n)return!0;return!1},An=function(e,n,r,i){t.L.call(this);var a=this;this.u=e,this.oa=n,this.Z=r,this.F=i,this.j=new fn,this.S=new t.kx,this.C=new t.eo((function(){a.retry()})),this.I=NaN,t.N(this,this.C),this.J=Yt(this.u,this.ea.bind(this))},yn=function(e){var n,r,i,a,o,u,s,c,E,l,f,d,_,A,y;return t.A((function(T){switch(T.j){case 1:if(e.B)throw Error("Already processing an action");if(e.isDisposed())return T.return();if(n=e.j.actions.shift(),function(t,e){t.j&&(t.F=e,Ee(t))}(e.Z,!n),void 0===n)return T.return();for(r=[n];(i=e.j.actions[0])&&0===i.retryScheduleIndex&&i.entityType===n.entityType;)r.push(e.j.actions.shift());if(e.B=r,a=e.oa[n.entityType]){T.Na(2);break}return e.B=void 0,t.x(T,yn(e),3);case 3:return T.return();case 2:for(o=t.t(r),u=o.next();!u.done;u=o.next())s=u.value,En(s,2);return t.pa(T,4,5),t.x(T,function(e,n){var r,i,a,o,u,s,c;return t.A((function(E){switch(E.j){case 1:r=new Map,i=t.t(n),a=i.next();case 2:if(a.done){E.Na(4);break}return o=a.value,s=(u=r).set,c=o,t.x(E,e.u(o),5);case 5:s.call(u,c,E.u),a=i.next(),E.Na(2);break;case 4:return E.return(r)}}))}(a,r.map((function(t){return t.action}))),7);case 7:c=T.u,E=t.t(r),u=E.next();case 8:if(u.done){T.Na(5);break}return l=u.value,f=c.get(l.action),t.x(T,Tn(e,l,f),9);case 9:u=E.next(),T.Na(8);break;case 5:t.gaa(T),e.B=void 0,t.haa(T,6);break;case 4:return d=t.ta(T),re("Orchestration error",d),t.pa(T,12),t.x(T,Sn(e,r),14);case 14:t.ra(T,5);break;case 12:for(_=t.ta(T),re("Orchestration retry error",_),A=t.t(r),u=A.next();!u.done;u=A.next())3>(y=u.value).retryScheduleIndex&&dn(e.j,[y]);T.Na(5);break;case 6:return t.x(T,yn(e),0)}}))},Tn=function(e,n,r){var i,a,o,u,s,c,E;return t.A((function(l){if(1==l.j){if(i=3===n.retryScheduleIndex+2,"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"===r.status){s=void 0;try{s=null==(c=r.C)?void 0:c.map((function(t){return e.createAction(t,n)}))}catch(t){return ln(n,r,i),E={entityKey:n.action.entityKey,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},oe(e.F,E),re("Orchestration subactions creation error",t),l.return()}return ln(n,r,i,s),t.x(l,Kt(e.u,{mode:"readwrite",dc:!0},(function(e){var r=[];if(s){var i=s.map((function(t){return nn(t)}));r.push(wt(e,i,"offlineOrchestrationActionWrapperEntity"))}return i=nn(n),r.push(xt(e,i.key)),t.mw.all(r)})),9)}return"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"!==r.status?l.Na(0):(ln(n,r,i),r.j&&3>n.retryScheduleIndex+1?t.x(l,Sn(e,[n]),0):(o=null!=(a=r)&&a.u?r.u:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u={entityKey:n.action.entityKey,failureReason:o},oe(e.F,u),re("Orchestration result is not retryable, deleting action"),t.x(l,function(t,e){return Kt(t,{mode:"readwrite",dc:!0},(function(t){return xt(t,e)}))}(e.u,nn(n).key),0)))}En(n,4),t.oa(l)}))},hn=function(e,n){var r,i,a,o,u,s,c,E,l,f,d,_;return t.A((function(A){for(r=[],i=1/0,a=4e3,o=t.t(n),u=o.next();!u.done;u=o.next())s=u.value,c=Number(s.enqueueTimeSec),E=pn(c),l=s.retryScheduleIndex,f=null!=l&&0<l,0<E&&f?(i=Math.min(i,c),a=Math.min(E,a)):r.push(s);return isFinite(i)&&(!e.C.isActive()||i<e.I)&&(e.I=i,e.C.start(a)),e.S.hh()||(d=r.length,r=r.filter((function(t){var e;return t=(null==(e=t.actionProto)?void 0:e.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN",!Ei.includes(t)})),_=r.length<d,!e.C.isActive()&&_&&e.C.start(1)),0<r.length&&In(e,r),t.x(A,e.B?Promise.resolve():yn(e),0)}))},pn=function(t){return 4e3<(t=1e3*t-Date.now())?4e3:t},Sn=function(e,n){var r,i,a;return t.A((function(o){for(r=t.t(n),i=r.next();!i.done;i=r.next()){var u,s=void 0,c=(null==(u=(a=i.value).action)||null==(s=u.actionMetadata)?void 0:s.retryScheduleIntervalsInSeconds)||[1,2,4];s=1,a.retryScheduleIndex<c.length&&(s=c[a.retryScheduleIndex]),a.j=1e3*s+Date.now(),a.retryScheduleIndex++}return t.x(o,On(e,n),0)}))},Rn=function(e){var n;return t.A((function(r){return 1==r.j?t.x(r,Gt(e.u,"offlineOrchestrationActionWrapperEntity"),2):(n=r.u,t.x(r,hn(e,n),0))}))},In=function(e,n){0!==n.length&&n.forEach((function(n){if(!n.key)throw Error("Entity key is required.");if(!n.actionProto)throw Error("OfflineOrchestrationAction is required.");var r=t.sH(n.key),i=t.sH(n.actionProto.entityKey);3>(n=new en(i.entityType,r.entityId,n.actionProto,n.parentActionId,n.rootActionId,n.childActionIds,n.prereqActionId,n.postreqActionIds,n.retryScheduleIndex,n.hasChildActionFailed,1e3*Number(n.enqueueTimeSec))).retryScheduleIndex&&dn(e.j,[n])}))},Nn=function(e,n){var r;return t.A((function(i){return 1==i.j?t.x(i,Gt(e.u,"offlineOrchestrationActionWrapperEntity",n),2):(r=i.u,i.return(r.filter(Zt)))}))},On=function(t,e){return 0===e.length?Promise.resolve([]):(e=e.map((function(t){return nn(t)})),Qt(t.u,e))},vn=function(){this.j=void 0},Fn=function(e,n){var r,i,a,o,u;return t.A((function(s){if(r=n.videoId,i=n.V(),a=!0,n.captionTracks.length)o=function(e){var n=new t.qB("und",new t.aE("Default","und",!0));return n.captionTracks=e.captionTracks,n}(n),e.j=new t.zO(i,n,o);else{if(!n.Kd)return s.return();u=t.dCa(n),e.j=new t.CO(i,n.Kd,r,u,n.jm),a=n.jm}return s.return(new Promise((function(n){var i;null==(i=e.j)||i.Pw((function(){return t.A((function(i){if(1==i.j)return t.x(i,mn(e,r,a),2);n(),t.oa(i)}))}))})))}))},mn=function(e,n,r){var i,a,o,u,s,c,E,l,f,d,_,A,y,T;return r=void 0===r||r,t.A((function(h){switch(h.j){case 1:if(!e.j)return h.return();for(i=[],a=t.wO(e.j.j,r),o=[],u={},s=t.t(a.entries()),c=s.next();!c.done;u={BF:u.BF},c=s.next())E=c.value,l=t.t(E),f=l.next().value,d=l.next().value,u.BF=f,_=d,A=e.j.Ts(_,"json3"),y=t.Pu(A,{withCredentials:!0,format:"RAW"},3,500).then(function(e){return function(n){n={metadata:t.RG(a[e.BF]),trackData:n.xhr.responseText},o.push(n)}}(u)).tj((function(t){re("Caption fetch error",t)})),i.push(y);return t.x(h,function(e){return new t.Hh((function(n,r){var i=e.length,a=[];if(i)for(var o,u=function(t,e){i--,a[t]=e,0==i&&n(a)},s=function(t){r(t)},c=0;c<e.length;c++)o=e[c],t.Sda(o,t.Ra(u,c),s);else n(a)}))}(i),2);case 2:return t.pa(h,3),t.x(h,function(e,n){var r,i;return t.A((function(a){if(1==a.j)return t.x(a,t.Lw(),2);if(3!=a.j){if(!(r=a.u))throw t.kw("wct");return t.x(a,t.AH(r),3)}return i=a.u,t.x(a,t.vw(i,["captions"],{mode:"readwrite",dc:!0},(function(r){var i=[];r=r.objectStore("captions");for(var a=0;a<n.length;a++){var o=t.ww(r,n[a],e+"|"+n[a].metadata.vss_id);i.push(o)}return t.mw.all(i)})),0)}))}(n,o),5);case 5:t.ra(h,0);break;case 3:T=t.ta(h),re("Caption DB transaction error",T),t.oa(h)}}))},Ln=function(e){var n;return t.A((function(r){return 1==r.j?t.x(r,function(e){var n,r,i;return t.A((function(a){if(1==a.j)return n=IDBKeyRange.bound(e+"|",e+"~"),t.x(a,t.Lw(),2);if(3!=a.j){if(!(r=a.u))throw t.kw("gactfv");return t.x(a,t.AH(r),3)}return i=a.u,a.return(i.getAll("captions",n))}))}(e),2):(n=r.u,r.return(!!n&&0<n.length))}))},wn=function(e,n){this.api=e,this.j=n,this.logger=new t.GT("woffle"),this.u=!1},xn=function(e){return t.A((function(t){return t.return(ee(e))}))},jn=function(e,n){var r=t.yH(n);return 1===r||0===r?Promise.resolve():((r=Cn(e,n))&&r.stopVideo(),e.B=0,xn(n))},Dn=function(e,n,r,i){r=void 0!==r&&r,i=void 0===i||i;var a="string"==typeof n?n:n.videoDetails.videoId;2===t.yH(a)&&((n=Cn(e,a))?n.stopVideo():e.logger.info((function(){return"Corresponding player for "+a+" not found. Pausing anyway"})),t.zH(a,2),e.B=2,r?Kn(e.j):i&&Yn(e.j))},Cn=function(t,e){var n;return(null==(n=t.player)?void 0:n.getVideoData().videoId)===e?t.player:null},Un=function(e){t.L.call(this),this.j=e,this.u=Yt(this.j,this.B.bind(this))},kn=function(e,n){var r,i,a,o,u,s,c;return t.A((function(E){switch(E.j){case 1:return 0===n.length?E.return([]):(r=n.map((function(e){return t.tH(e,"transfer")})),t.x(E,Gt(e.j,"transfer",r),2));case 2:if(i=E.u,a=i.filter(Zt).map((function(e){return t.sH(e.key).entityId})),0===(o=n.filter((function(t){return-1===a.indexOf(t)}))).length)return E.return([]);u=t.t(o),s=u.next();case 3:if(s.done){E.Na(5);break}return c=s.value,t.x(E,xn(c),4);case 4:s=u.next(),E.Na(3);break;case 5:return E.return(o)}}))},Pn=function(t,e,n,r){if(t&&t.streamsProgress){r=t;t:{e=e.itag+";"+e.xtags;for(var i=t.streamsProgress,a=0;a<i.length;a++){var o=JSON.parse(i[a].formatStreamBytes);if(o.itag+";"+o.xtags===e){i[a]=n,n=i;break t}}i.push(n),n=i}r.streamsProgress=n}else t={key:r,streamsProgress:[n]};return t},bn=function(e,n,r,i){t.L.call(this);var a=this;this.u=e,this.api=n,this.Ba=r,this.Aa=i,this.F=new t.kx,this.C=new t.eo((function(){a.j&&"TRANSFER_STATE_TRANSFERRING"===a.j.transferState&&a.F.hh()&&(3>(a.j.transferRetryCount||0)?Dn(a.I,a.B,!1,!1):jn(a.I,a.B.videoDetails.videoId),a.Ht("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))})),this.Z=0,this.ya=new t.bE(this),this.J=Yt(this.u,this.GV.bind(this)),this.I=new wn(n,this),this.La=new vn,this.S=new Un(this.u),this.oa=this.F.Ra("publicytnetworkstatus-online",this.QA.bind(this)),this.ea=this.F.Ra("publicytnetworkstatus-offline",this.K4.bind(this)),t.N(this,this.ya),this.ya.T(n,"offlinetransferpause",this.L4),this.Ia=t.aF(this.api.V().experiments,"web_player_transfer_timeout_threshold_ms")},Hn=function(e,n){var r;return n=void 0!==n&&n,t.A((function(i){if(1==i.j){if(e.j)throw Error("Already downloading a video");return t.x(i,Bn(e),2)}return 4!=i.j?(r=i.u,function(t,e){t.j&&(t.I=e,Ee(t))}(e.Ba,!r),r&&e.F.hh()?n?t.x(i,new Promise((function(e){t.Hu(e,1e3)})),4):i.Na(4):(!r&&e.j&&Xn(e),i.Na(0))):t.x(i,gn(e,r),0)}))},Mn=function(e,n){var r;return t.A((function(i){switch(i.j){case 1:return t.pa(i,2),!!n.captionTracks.length||!!n.Kd?t.x(i,Ln(n.videoId),4):i.return();case 4:return i.u?i.return():t.x(i,Fn(e.La,n),5);case 5:t.ra(i,0);break;case 2:r=t.ta(i),re("Caption downloading error",r,n.cotn),t.oa(i)}}))},gn=function(e,n){var r,i,a,o,u;return t.A((function(s){switch(s.j){case 1:if(e.j=n,r=t.sH(e.j.key),"TRANSFER_STATE_TRANSFERRING"===e.j.transferState){fe({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:r.entityId,Wj:e.j}),s.Na(2);break}if("TRANSFER_STATE_TRANSFER_IN_QUEUE"!==e.j.transferState||e.j.transferRetryCount||e.j.hasLoggedFirstStarted){s.Na(2);break}return e.j.hasLoggedFirstStarted=!0,t.x(s,zn(e),4);case 4:de({videoId:r.entityId,Wj:e.j},void 0,void 0,!0);case 2:return t.x(s,Vn(e),5);case 5:return i=null,t.pa(s,6),t.x(s,$n(e,n),8);case 8:i=s.u,e.B=i,t.ra(s,7);break;case 6:return a=t.ta(s),re("error getting player response",a,n.cotn),t.x(s,e.Ht("TRANSFER_FAILURE_REASON_INTERNAL"),9);case 9:return s.return();case 7:return o=tn(e.api.V(),n.cotn,i),t.x(s,Mn(e,o),10);case 10:return u=o,t.x(s,function(e){var n;return t.A((function(r){return 1==r.j?t.x(r,t.FAa(e),2):(n=r.u,r.return(n.filter((function(t){return!!t.url})).map((function(t){return t.url}))))}))}(o.videoId),11);case 11:u.ut=s.u;var c,E=e.I,l=n.maximumDownloadQuality;o.getPlayerResponse(),t.zH(o.videoId,2),E.B=2,E.u=!1,null==(c=E.player)||c.dispose(),E.player=E.api.Yv(9,o),c={},t.cz(E.player,(c.localmediachange=E.gE,c.signatureexpired=E.kK,c.statechange=E.t2,c),E),l=function(t){switch(t){case"HD_1080":return"hd1080";case"HD":default:return"hd720";case"SD":return"large";case"LD":return"tiny"}}(l),E.N("hoffle_lmqf_killswitch")||t.RRa(E.player,t.tB(l,l,!0,"m"),!1),t.US(E.player,!1),Zn(e),t.oa(s)}}))},Bn=function(e){var n,r;return t.A((function(i){return 1==i.j?t.x(i,Gt(e.u,"transfer"),2):(n=i.u,0===(r=n.filter(er).sort(nr)).length?i.return():i.return(r[0]))}))},Vn=function(e){return t.A((function(n){return e.j?(Zn(e),t.x(n,Jn(e,"TRANSFER_STATE_TRANSFERRING"),0)):(tr(e,"onTransferStart"),n.return())}))},Kn=function(e){var n,r,i;t.A((function(a){if(1==a.j)return e.j?(n=e.j,e.C.stop(),t.x(a,Jn(e,"TRANSFER_STATE_PAUSED_BY_USER"),3)):(tr(e,"onTransferPausedByUser"),a.Na(2));2!=a.j&&(i=null!=(r=n)&&r.key?t.sH(n.key).entityId:"",_e({videoId:i,Wj:n})),Xn(e),Hn(e),t.oa(a)}))},Yn=function(e){t.A((function(n){if(1==n.j)return e.j?(e.C.stop(),t.x(n,Jn(e,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)):(tr(e,"onTransferPausedByNetwork"),n.return());Xn(e),t.oa(n)}))},Wn=function(e){var n,r,i,a;t.A((function(o){switch(o.j){case 1:if(!e.j)return tr(e,"onTransferComplete"),o.return();if(n=e.j,e.C.stop(),!n||!e.B){o.Na(2);break}return r=tn(e.api.V(),n.cotn,e.B),t.x(o,Mn(e,r),2);case 2:return t.x(o,Jn(e,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:return a=null!=(i=n)&&i.key?t.sH(n.key).entityId:"",t.x(o,function(e,n){var r,i,a,o,u;return t.A((function(s){if(1==s.j)return r=t.tH(n,"offlineVideoStreams"),t.x(s,qt(e,r,"offlineVideoStreams"),2);if(!(i=s.u)||!i.streamsProgress)return s.return();for(a=t.t(i.streamsProgress),o=a.next();!o.done;o=a.next())(u=o.value).streamState="DOWNLOAD_STREAM_STATE_COMPLETE",u.numTotalBytes!==u.numBytesDownloaded&&(u.numBytesDownloaded=u.numTotalBytes);return t.x(s,Wt(e,i,"offlineVideoStreams"),0)}))}(e.u,a),5);case 5:fe({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",statusType:"SUCCESS"},{videoId:a,Wj:n}),Xn(e),Hn(e),t.oa(o)}}))},Qn=function(e,n,r){var i;t.A((function(a){switch(a.j){case 1:if(!e.j)return tr(e,"onTransferProgress: "+n),a.return();if("TRANSFER_STATE_TRANSFERRING"===e.j.transferState){a.Na(2);break}return t.x(a,Vn(e),2);case 2:if(!(1e3<(i=Date.now())-e.Z)){a.Na(4);break}return e.Z=i,t.x(a,function(e,n,r,i,a,o){var u,s,c;return t.A((function(E){return u="STREAM_TYPE_UNKNOWN",r.video&&r.audio?(u="STREAM_TYPE_AUDIO_AND_VIDEO",re("unexpected stream type")):r.video&&!r.audio?u="STREAM_TYPE_VIDEO":!r.video&&r.audio&&(u="STREAM_TYPE_AUDIO"),s=t.tH(n,"offlineVideoStreams"),c={numBytesDownloaded:a.toFixed(),numTotalBytes:o.toFixed(),streamType:u,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(i),itag:"STREAM_TYPE_AUDIO_AND_VIDEO"===u?Number(r.itag):void 0},t.x(E,Kt(e,{mode:"readwrite",dc:!0},(function(e){var r=Ft(e,s,"offlineVideoStreams"),a=Ft(e,t.tH(n,"transfer"),"transfer");return t.mw.all([r,a]).then((function(n){var r=t.t(n);return n=r.next().value,(r=r.next().value)?(n=[Lt(e,Pn(n,i,c,s),"offlineVideoStreams")],r.offlineVideoStreams||(r.offlineVideoStreams=[]),-1===r.offlineVideoStreams.indexOf(s)&&(r.offlineVideoStreams.push(s),n.push(Lt(e,r,"transfer"))),t.mw.all(n)):xt(e,s).then((function(){}))}))})),0)}))}(e.u,r.videoId,r.u,r.formatStream,r.bytesDownloaded,r.j),5);case 5:de({videoId:n,Wj:e.j},r.bytesDownloaded,r.j);case 4:Zn(e),t.oa(a)}}))},qn=function(t){var e=3>(t.j.transferRetryCount||0);return e&&((t=t.j).transferRetryCount=(t.transferRetryCount||0)+1),e},Gn=function(e,n){var r,i;return n=void 0===n?"TRANSFER_FAILURE_REASON_UNKNOWN":n,t.A((function(a){if(1==a.j)return e.j||tr(e,"setTransferToFailed: "+n),r="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","TRANSFER_FAILURE_REASON_NETWORK"===n?r="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"===n&&(r="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),t.x(a,Jn(e,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",n),2);oe(e.Aa,{entityKey:null==(i=e.j)?void 0:i.key,failureReason:r});var o={videoId:e.j?t.sH(e.j.key).entityId:"",Wj:e.j},u=n,s={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};u&&(s.transferFailureReason=u,s.failureReason=function(t){switch(t){case"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case"TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";case"TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case"TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case"TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case"TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case"TRANSFER_FAILURE_REASON_SERVER":case"TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case"TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}}(u)),fe(s,o),t.oa(a)}))},Jn=function(e,n,r,i){var a;return t.A((function(o){return 1==o.j?e.j?(e.j.transferState=n,e.j.failureReason=i,t.pa(o,2),t.x(o,zn(e,(function(n){return r?mt(n,"offlineVideoStreams",e.j.offlineVideoStreams).then((function(e){for(var i=t.t(e),a=i.next();!a.done;a=i.next())if((a=a.value)&&a.streamsProgress)for(var o=(a=t.t(a.streamsProgress)).next();!o.done;o=a.next())o.value.streamState=r;return wt(n,e.filter((function(t){return!!t})),"offlineVideoStreams")})):t.mw.resolve(void 0)})),4)):(tr(e,"saveTransferState: "+n),o.return()):2!=o.j?t.ra(o,0):(a=t.ta(o))instanceof t.fw&&"QUOTA_EXCEEDED"===a.type?t.x(o,e.Ht("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):o.Na(0)}))},zn=function(e,n){var r;return t.A((function(i){return e.j?(r=e.j,t.x(i,Kt(e.u,{mode:"readwrite",dc:!0},(function(e){var i=[Lt(e,r,"transfer")];return n&&i.push(n(e)),t.mw.all(i)})),0)):i.return()}))},Xn=function(t){t.j=void 0,t.B=void 0,t.C.stop()},$n=function(e,n){var r,i,a,o,u;return t.A((function(s){if(1==s.j)return r=t.sH(n.key),i=r.entityId,a=t.tH(i,"playbackData"),t.x(s,qt(e.u,a,"playbackData"),2);if(o=s.u,null!=(u=o)&&u.playerResponseJson)return s.return(JSON.parse(o.playerResponseJson));throw Error("No PlayerResponse found")}))},Zn=function(t){t.C.start(t.Ia||18e5)},tr=function(t,e){t.api.va("woffle",{mcte:e}),re("missing current transfer entity.")},er=function(t){return void 0!==fi[t.transferState]},nr=function(t,e){var n=fi[t.transferState],r=fi[e.transferState];return n!==r?n-r:Number(t.enqueuedTimestampMs)-Number(e.enqueuedTimestampMs)},rr=function(e,n){var r=this;this.Y=e,this.api=n,this.S=new t.kx,this.B=new se((function(){return ir(r)}),(function(){ur(r)}),this.api.lq(),this.api.N.bind(this.api)),this.j=new ae(this.api),this.C=new t.$i,ce(this.B)},ir=function(e){return t.A((function(n){e.api.Pa("onOrchestrationBecameLeader"),e.u&&e.F||ar(e).then(e.C.resolve).catch(e.C.reject);var r=e.C.promise;return t.x(n,r,0)}))},ar=function(e){var n,r,i;return t.A((function(a){return 1==a.j?t.x(a,zt(),2):3!=a.j?(n=a.u)?(e.u=new bn(n,e.api,e.B,e.j),r=e.qz(n),i=e,t.x(a,function(e,n,r,i){var a;return t.A((function(o){return 1==o.j?(a=new An(e,n,r,i),t.x(o,Rn(a),2)):(a.B?Promise.resolve():yn(a),o.return(a))}))}(n,r,e.B,e.j),3)):(re("PES is undefined"),a.return()):(i.F=a.u,t.x(a,or(e),0))}))},or=function(e){var n;return t.A((function(r){switch(r.j){case 1:if(!e.u)return re("transferManager is undefined"),r.return();if(e.u.j){r.Na(2);break}return t.x(r,Hn(e.u),2);case 2:return t.x(r,e.refreshAllStaleEntities(43200,!0),4);case 4:return t.x(r,e.yH(),5);case 5:return e.I=t.Iu((function(){e.refreshAllStaleEntities(43200,!0),e.yH()}),9e5),t.Mv(t.Ov(),(function(){return e.iL()})),t.x(r,zt(),6);case 6:return n=r.u,t.x(r,function(e){var n;return t.A((function(r){if(1==r.j)return t.x(r,ie(e),2);n=r.u,t.Wv("offlineStateSnapshot",n),t.oa(r)}))}(n),7);case 7:(function(t){t.j&&(t.C=!0,Ee(t))})(e.B),t.oa(r)}}))},ur=function(n){var r,i;t.A((function(a){if(1==a.j)return n.u||n.F?t.x(a,n.C.promise,2):a.return();void 0!==n.I&&(e.clearInterval(n.I),n.I=void 0),null==(r=n.u)||r.dispose(),n.u=void 0,null==(i=n.F)||i.dispose(),n.F=void 0,n.api.Pa("onOrchestrationLostLeader"),n.C=new t.$i,t.oa(a)}))},sr=function(e,n,r,i,a){var o,u,s;return t.A((function(c){return 1==c.j?t.x(c,zt(),2):(o=c.u)?(u=n.map((function(e){var n=t.tH(e,r);return n={actionType:i,entityKey:n,actionMetadata:Object.assign({},{priority:1,retryScheduleIntervalsInSeconds:[1,2,4]},a)},"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"!==i&&(n.actionMetadata.priority=0),e=new en(r,e,n),nn(e)})),s=Qt(o,u),ce(e.B),c.return(s)):c.return([])}))},cr=function(e){var n,r,i,a,o;return t.A((function(u){switch(u.j){case 1:return n=t.TM(),r=function(e){return{context:t.HK(),videoIds:e}}(e),i=t.EM(Vr),t.pa(u,2),t.x(u,t.NK(n,r,i),4);case 4:a=u.u,t.ra(u,3);break;case 2:throw o=t.ta(u),re("GetOffline fetch request error",o),Error("GetOffline fetch request error");case 3:if(!a)throw Error("Network request failed");if(!a.videos||!a.videos.length)throw Error("No data");return u.return(a.videos.map((function(t){return t.offlineVideoData})))}}))},Er=function(e){var n,r,i,a,o;return t.A((function(u){switch(u.j){case 1:return n=t.TM(),r=function(e){return{context:t.HK(),playlistIds:e}}(e),i=t.EM(Vr),t.pa(u,2),t.x(u,t.NK(n,r,i),4);case 4:a=u.u,t.ra(u,3);break;case 2:throw o=t.ta(u),re("GetOffline fetch request error for playlist",o),Error("GetOffline fetch request error for playlist");case 3:if(!a)throw Error("Network request failed");if(!a.playlists||!a.playlists.length)throw Error("No data");return u.return(a.playlists.map((function(t){return t.offlinePlaylistData})))}}))},lr=function(e,n,r,i){var a,o,u,s,c,E,l,f,d,_,A,y,T,h,p,S,R,I,N,O,v,F,m,L,w,x,j,D,C;return t.A((function(U){switch(U.j){case 1:return t.x(U,zt(),2);case 2:if(!(a=U.u))return U.return([]);if(o=[],null!=(u=i)&&u.length){o=i,U.Na(3);break}return t.x(U,Gt(a,"mainPlaylistEntity"),4);case 4:o=U.u;case 3:if(!o.length)return U.return([]);s=[],c=Date.now()/1e3,E=t.t(o),l=E.next();case 5:if(l.done)return s.length?t.x(U,dr(s),10):U.return([]);if(!(f=l.value).downloadState){d=void 0,U.Na(8);break}return t.x(U,qt(a,f.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:d=U.u;case 8:if(_=d,y=(A=f.entityMetadata)&&A.nextAutoRefreshIntervalSeconds?Number(A.nextAutoRefreshIntervalSeconds):NaN,T=Number.isNaN(y)?e:y,p=void 0,S=null!=(h=_)&&h.lastSyncedTimestampMillis?Number(null==(p=_)?void 0:p.lastSyncedTimestampMillis)/1e3:0,I=void 0,N=null!=(R=_)&&R.addedTimestampMillis?Number(null==(I=_)?void 0:I.addedTimestampMillis)/1e3:0,r||!A||S+T<=c){if(O=[],void 0,null!=(v=f.videos)&&v.length)for(F=t.t(f.videos),m=F.next();!m.done;m=F.next())L=m.value,(w=JSON.parse(t.sH(L).entityId)).videoId&&O.push(w.videoId);x="0",A&&(void 0,x=String(Number(null!=(j=A.offlineLastModifiedTimestampSeconds)?j:0).toFixed())),D={playlistId:f.playlistId,videoIds:O,offlineLastModifiedTimestamp:x,autoSync:n,offlineDateAddedTimestamp:String(N)},s.push(D)}l=E.next(),U.Na(5);break;case 10:return C=U.u,U.return(C)}}))},fr=function(e){var n,r,i,a,o,u,s;return t.A((function(c){switch(c.j){case 1:return n=t.TM(),t.x(c,zt(),2);case 2:if(!(r=c.u)){c.Na(3);break}return t.x(c,ie(r),4);case 4:i=c.u;case 3:var E=i;return a={context:t.HK(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:e},offlineClientState:E}}},o=t.EM(gr),t.pa(c,5),t.x(c,t.NK(n,a,o),7);case 7:u=c.u,t.ra(c,6);break;case 5:throw s=t.ta(c),re("DPS fetch request error for smart downloads",s),Error("DPS fetch request error for smart downloads");case 6:if(!u)throw Error("Network request failed");return c.return(u)}}))},dr=function(e){var n,r,i,a,o;return t.A((function(u){switch(u.j){case 1:return n=t.TM(),r=function(e){return{context:t.HK(),offlinePlaylistSyncChecks:e}}(e),i=t.EM(Br),t.pa(u,2),t.x(u,t.NK(n,r,i),4);case 4:a=u.u,t.ra(u,3);break;case 2:throw o=t.ta(u),re("offlinePlaylistSyncCheck fetch request error",o),Error("offlinePlaylistSyncCheck fetch request error");case 3:if(!a)throw Error("Network request failed");if(!a.offlinePlaylistSyncCheckDatas||!a.offlinePlaylistSyncCheckDatas.length)throw Error("No data");return u.return(a.offlinePlaylistSyncCheckDatas.map((function(t){return t.offlinePlaylistSyncCheckData})))}}))},_r=function(t,e){this.j=t,this.B=e},Ar=function(e,n,r,i){var a,o,u,s,c;return t.A((function(E){switch(E.j){case 1:return t.x(E,Er([n]),2);case 2:return a=E.u,t.x(E,yr(e,a[0],r,i),3);case 3:return o=E.u,u=o.mainPlaylistEntity,s=o.S4,c=Pe(u,s.avatar),t.x(E,Re(c),4);case 4:return E.return(a[0].videos)}}))},yr=function(e,n,r,i){var a,o,u,s,c,E,l,f,d,_,A,y,T,h,p,S;return t.A((function(R){if(1==R.j){if(a=Date.now().toString(),r||(r=a),o=n.videos,u=n.playlistId,s=[],c=[],o)for(E=t.t(o),l=E.next();!l.done;l=E.next()){if(f=l.value,!(d=f.offlineVideoData)||!d.videoId)throw Error("Invalid offlineVideoData");_=d.videoId,A={videoId:_,playlistId:u},y={id:t.tH(JSON.stringify(A),"mainPlaylistVideoEntity"),video:t.tH(_,"mainVideoEntity")},s.push(y),c.push(y.id)}return T=n.channel.offlineChannelData,h=Tr(t.tH(u,"ytMainChannelEntity"),T),p={key:t.tH(u,"mainPlaylistDownloadStateEntity"),addedTimestampMillis:r,lastSyncedTimestampMillis:a},(S={key:t.tH(u,"mainPlaylistEntity"),playlistId:u,channelOwner:h.id,videos:c,title:n.title,thumbnailStyleData:hr(n),visibility:pr(n),downloadState:p.key}).entityMetadata?(S.entityMetadata.offlineLastModifiedTimestampSeconds=n.lastModifiedTimestamp,i&&(S.entityMetadata.nextAutoRefreshIntervalSeconds=String(i))):S.entityMetadata={nextAutoRefreshIntervalSeconds:i?String(i):void 0,offlineLastModifiedTimestampSeconds:n.lastModifiedTimestamp},t.x(R,Kt(e.j,{mode:"readwrite",dc:!0},(function(e){for(var n=Lt(e,S,"mainPlaylistEntity"),r=Lt(e,h,"ytMainChannelEntity"),i=Lt(e,p,"mainPlaylistDownloadStateEntity"),a=[],o=t.t(s),u=o.next();!u.done;u=o.next())a.push(Lt(e,u.value,"mainPlaylistVideoEntity"));return t.mw.all([n,r,i].concat(t.u(a)))})),2)}return R.return({mainPlaylistEntity:S,S4:h,w8a:s})}))},Tr=function(t,e){return{id:t,channelId:e.channelId,title:e.title,avatar:e.thumbnail}},hr=function(e){var n=[],r=e.videos;if(r&&0<r.length&&n.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:r[0].offlineVideoData.thumbnail}}}),(e=e.additionalMetadadatas)&&0<e.length)for(r=(e=t.t(e)).next();!r.done;r=e.next()){var i=r.value.offlineBundleItemPlaylistData,a=void 0;switch(r=null==(a=i)?void 0:a.style,a=void 0,i={collageThumbnail:{coverThumbnail:null==(a=i)?void 0:a.coverThumbnail}},r){case"BUNDLE_ITEM_STYLE_UNSPECIFIED":n.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),value:i});break;case"BUNDLE_ITEM_STYLE_TWO_BY_TWO":n.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:i});break;case"BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":n.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:i});break;case"BUNDLE_ITEM_STYLE_ONE_AND_TWO":n.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:i})}}return n},pr=function(t){switch(t.privacy){case"PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";case"PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case"UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},Sr=function(e,n){return n={offlineVideoData:n},(e=t.S(e.actionMetadata,zr))&&(n.maximumDownloadQuality=e.maximumDownloadQuality),{mainVideoEntityActionMetadata:n}},Rr=function(t,e){this.j=t,this.B=e},Ir=function(e,n,r,i){var a,o,u,s,c;return t.A((function(E){switch(E.j){case 1:if(a=i){E.Na(2);break}return t.x(E,cr([n]),3);case 3:o=E.u,a=o[0];case 2:return t.x(E,Nr(e,a,r),4);case 4:u=E.u,s=u.mainVideoEntity,c=u.channelEntity;var l=ke(s.thumbnail),f=ke(c.avatar);return l=l.concat(f),t.x(E,Re(l),0)}}))},Nr=function(e,n,r){var i,a,o,u,s;return t.A((function(c){return 1==c.j?(r||(r=Date.now().toString()),a=null==(i=n.channel)?void 0:i.offlineChannelData,o={id:t.tH(n.videoId,"ytMainChannelEntity"),channelId:a.channelId,title:a.title,avatar:a.thumbnail},u={key:t.tH(n.videoId,"mainVideoDownloadStateEntity"),playbackData:t.tH(n.videoId,"playbackData"),addedTimestampMillis:r},s={key:t.tH(n.videoId,"mainVideoEntity"),videoId:n.videoId,title:n.title,thumbnail:n.thumbnail,localizedStrings:{viewCount:n.shortViewCountText},lengthSeconds:n.lengthSeconds?Number(n.lengthSeconds):void 0,publishedTimestampMillis:n.publishedTimestamp?(1e3*Number(n.publishedTimestamp)).toString():void 0,formattedDescription:n.description,owner:o.id,downloadState:u.key},t.x(c,Kt(e.j,{mode:"readwrite",dc:!0},(function(e){var n=Lt(e,o,"ytMainChannelEntity"),r=Lt(e,u,"mainVideoDownloadStateEntity");return e=Lt(e,s,"mainVideoEntity"),t.mw.all([n,r,e])})),2)):c.return({mainVideoEntity:s,channelEntity:o})}))},Or=function(t,e,n){this.j=t,this.Y=e,this.B=n},vr=function(){rr.apply(this,arguments),this.J="mainVideoEntity"},Fr=function(e,n,r){n=void 0===n?43200:n,r=void 0===r||r;var i,a,o=void 0!==o&&o;return t.A((function(u){return 1==u.j?e.S.hh()?t.x(u,lr(n,r,o),2):u.return([]):(i=u.u,a=function(e,n,r){var i,a,o,u,s,c,E;return t.A((function(l){switch(l.j){case 1:i=[],a=t.t(n),o=a.next();case 2:if(o.done){l.Na(4);break}if((u=o.value).upToDate||r&&!u.shouldAutoSyncMetadata||!u.playlistId){l.Na(3);break}return c={nextAutoRefreshIntervalSeconds:u.checkInSeconds,autoSync:r},s={mainPlaylistEntityActionMetadata:c},t.x(l,sr(e,[u.playlistId],"mainPlaylistEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",s),6);case 6:(E=l.u)&&i.push.apply(i,t.u(E));case 3:o=a.next(),l.Na(2);break;case 4:return l.return(i)}}))}(e,i,r),u.return(a))}))},mr=function(e,n,r){var i,a,o,u,s,c,E,l,f,d,_,A,y,T,h,p,S,R,I;return r=void 0!==r&&r,t.A((function(N){switch(N.j){case 1:return i=[],t.x(N,function(){var e,n,r,i,a;return t.A((function(o){return 1==o.j?t.x(o,zt(),2):3!=o.j?(e=o.u)?t.x(o,Gt(e,"refresh"),3):o.return(!1):(n=o.u,null!=(r=n[0])&&r.refreshTime?(i=Number(n[0].refreshTime),a=Date.now()/1e3,o.return(isFinite(i)&&a>=i)):o.return(!1))}))}(),2);case 2:return N.u||r?t.x(N,zt(),3):N.return([]);case 3:return a=N.u,t.x(N,Ke(a),4);case 4:for((o=N.u).reverse(),u=[],s=t.t(o),c=s.next();!c.done;c=s.next())(E=c.value)&&u.push(t.sH(E).entityId);return t.x(N,function(e){var n,r,i;return t.A((function(a){switch(a.j){case 1:return t.pa(a,2),t.x(a,fr(e),4);case 4:return r=a.u,t.x(a,Be(r),5);case 5:n=Ve(r),t.ra(a,3);break;case 2:i=t.ta(a),re("getAndProcessSmartDownloadsResponse request or processing error",i);case 3:return a.return(n)}}))}(n),5);case 5:if(l=N.u,null==(f=l)||!f.length)return N.return([]);if(!u.length){N.Na(6);break}return t.x(N,sr(e,u,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"),7);case 7:d=N.u,i=i.concat(d);case 6:_=t.t(l),A=_.next();case 8:if(A.done){N.Na(10);break}if(y=A.value,T=y.actionType,h=y.entityKey,p=y.actionMetadata,!(T&&h&&p)||t.S(p,ei)){N.Na(9);break}return S=t.sH(h),R=S.entityId,t.x(N,sr(e,[R],"mainVideoEntity",T,p),12);case 12:I=N.u,i=i.concat(I);case 9:A=_.next(),N.Na(8);break;case 10:return N.return(i)}}))},Lr=function(t,e){this.j=t,this.B=e},wr=function(e,n){var r,i,a,o,u,s,c,E,l,f,d,_,A,y,T,h,p,S,R,I,N,O,v,F,m,L,w,x,j,D,C,U,k,P,b,H,M,g,B,V,K,Y,W,Q,q,G,J,z,X,$,Z,tt,et,nt,rt,it,at,ot,ut,st,ct,Et,lt,ft,dt,_t,At,yt;return t.A((function(Tt){switch(Tt.j){case 1:return r=Ie(n),i=n.entityKey,a=t.sH(i).entityId,o=[],u=!1,"!*$_ALL_ENTITIES_!*$"===a?(u=!0,t.x(Tt,Gt(e.j,"musicPlaylist"),5)):t.x(Tt,qt(e.j,i,"musicPlaylist"),4);case 4:(s=Tt.u)&&o.push(s),Tt.Na(3);break;case 5:o=Tt.u;case 3:if(null==(c=o)||!c.length)return Tt.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));if(E=t.S(n.actionMetadata,$r),f=null==(l=E)?void 0:l.autoSync,d=[],A=_=!0,y=!1,T=void 0,!u&&!1===f){Tt.Na(6);break}return t.x(Tt,function(e,n){var r,i,a,o,u,s,c,E,l,f,d,_,A,y,T,h,p,S,R,I,N,O,v;return t.A((function(F){switch(F.j){case 1:return t.x(F,zt(),2);case 2:if(!(r=F.u))return F.return([]);if(i=[],null!=(a=n)&&a.length){i=n,F.Na(3);break}return t.x(F,Gt(r,"musicPlaylist"),4);case 4:i=F.u;case 3:if(!i.length)return F.return([]);o=[],Date.now(),u=t.t(i),s=u.next();case 5:if(s.done)return o.length?t.x(F,dr(o),10):F.return([]);if(c=s.value,l=(E=c.entityMetadata)&&E.nextAutoRefreshIntervalSeconds?Number(E.nextAutoRefreshIntervalSeconds):NaN,Number.isNaN(l),d=f=0,!c.downloadMetadata){F.Na(8);break}return t.x(F,qt(r,c.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:_=F.u,f=Number(null!=(y=null==(A=_)?void 0:A.addedTimestampMillis)?y:"0")/1e3,d=Number(null!=(h=null==(T=_)?void 0:T.lastModifiedTimestampMillis)?h:"0")/1e3;case 8:if(p=[],null!=(S=c.tracks)&&S.length)for(R=t.t(c.tracks),I=R.next();!I.done;I=R.next())N=I.value,p.push(t.sH(N).entityId);O={playlistId:c.playlistId,videoIds:p,offlineLastModifiedTimestamp:String(d.toFixed()),autoSync:e,offlineDateAddedTimestamp:String(f.toFixed())},o.push(O),s=u.next(),F.Na(5);break;case 10:return v=F.u,F.return(v)}}))}(!!f,o),7);case 7:if(!(d=Tt.u).length||!u&&d[0].playlistId!==a)return Tt.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));case 6:if(u){for(h=[],p=t.t(d),S=p.next();!S.done;S=p.next())(R=S.value).upToDate||f&&!R.shouldAutoSyncMetadata||!R.playlistId||(I={autoSync:f},h.push(We("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",R.playlistId,"musicPlaylist",0,Ai,{musicPlaylistEntityActionMetadata:I})));return Tt.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,h))}if(d.length&&(N=d[0],y=!!N.upToDate,f&&(_=null==(O=N.shouldAutoSyncMetadata)||O,A=null==(v=N.shouldAutoSyncVideos)||v,N.checkInSeconds&&(T=N.checkInSeconds))),y||!_)return Tt.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));if(F=[],m=o[0],L=void 0,!m.downloadMetadata){Tt.Na(8);break}return t.x(Tt,qt(e.j,m.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:w=Tt.u,L=Number(null!=(j=null==(x=w)?void 0:x.addedTimestampMillis)?j:"0")/1e3;case 8:return t.pa(Tt,10),t.x(Tt,xr(e,a,null==(D=L)?void 0:D.toString(),T),12);case 12:F=Tt.u,t.ra(Tt,11);break;case 10:return(C=t.ta(Tt))instanceof Error&&"No data"===C.message?t.x(Tt,xe(a,e.j,n,e.B),11):(U="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",C instanceof t.fw&&"QUOTA_EXCEEDED"===C.type&&(U="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Tt.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,U,k)));case 11:if(!A)return Tt.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));if(P=[],b=new Map,null!=(H=F)&&H.length)for(M=t.t(F),g=M.next();!g.done;g=M.next())B=g.value,V=B.offlineVideoData,void 0,null!=(K=V)&&K.videoId&&b.set(V.videoId,V);if(Y=new Map,W=[],null!=(Q=m)&&(null!=(q=Q.tracks)&&q.length))for(G=t.t(m.tracks),J=G.next();!J.done;J=G.next())z=J.value,(X=t.sH(z).entityId)&&(b.has(X)?(Y.set(X,b.get(X)),b.delete(X)):W.push(X));for($=t.t(b.entries()),Z=$.next();!Z.done;Z=$.next())tt=Z.value,et=t.t(tt),nt=et.next().value,rt=et.next().value,it=nt,at=rt,P.push(We("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",it,"musicTrack",0,Ai,Cr(n,at)));for(ot=t.t(Y.entries()),ut=ot.next();!ut.done;ut=ot.next())st=ut.value,ct=t.t(st),Et=ct.next().value,lt=ct.next().value,ft=Et,dt=lt,P.push(We("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",ft,"musicTrack",0,Ai,Cr(n,dt)));for(_t=t.t(W),At=_t.next();!At.done;At=_t.next())yt=At.value,P.push(We("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",yt,"musicTrack",0,Ai));return Tt.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,P))}}))},xr=function(e,n,r,i){var a,o,u,s;return t.A((function(c){switch(c.j){case 1:return t.x(c,Er([n]),2);case 2:return a=c.u,t.x(c,jr(e,a[0],r,i),3);case 3:return o=c.u,u=o.musicPlaylistEntity,s=ke(u.thumbnailDetails),t.x(c,Re(s),4);case 4:return c.return(a[0].videos)}}))},jr=function(e,n,r,i){var a,o,u,s,c,E,l,f,d,_,A,y,T,h,p,S;return t.A((function(R){if(1==R.j){if(a=n.videos,o=n.playlistId,u=[],s=[],c=[],E=r?(1e3*Number(r)).toString():Date.now().toString(),a)for(l=t.t(a),f=l.next();!f.done;f=l.next())d=f.value,_=d.offlineVideoData,A=_.videoId,y={id:t.tH(A,"musicTrack")},T=t.tH(A,"musicTrackDownloadMetadataEntity"),u.push(y),s.push(y.id),c.push(T);return h=n.lastModifiedTimestamp?(1e3*Number(n.lastModifiedTimestamp)).toString():"0",p={id:t.tH(o,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:c,lastModifiedTimestampMillis:h,addedTimestampMillis:E,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},S={id:t.tH(o,"musicPlaylist"),title:n.title,playlistId:o,thumbnailDetails:n.thumbnail,visibility:Dr(n),trackCount:n.totalVideoCount,tracks:s,downloadMetadata:p.id},i&&(S.entityMetadata?S.entityMetadata.nextAutoRefreshIntervalSeconds=String(i):S.entityMetadata={nextAutoRefreshIntervalSeconds:String(i)}),t.x(R,Kt(e.j,{mode:"readwrite",dc:!0},(function(e){for(var n=Lt(e,S,"musicPlaylist"),r=[],i=t.t(u),a=i.next();!a.done;a=i.next())r.push(Lt(e,a.value,"musicTrack"));return e=Lt(e,p,"musicPlaylistDownloadMetadataEntity"),t.mw.all([n].concat(t.u(r),[e]))})),2)}return R.return({musicPlaylistEntity:S,Q8a:u})}))},Dr=function(t){switch(t.privacy){case"PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";case"PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case"UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},Cr=function(e,n){return n={track:De(n)},(e=t.S(e.actionMetadata,$r))&&(n.maximumDownloadQuality=e.maximumDownloadQuality),{musicTrackEntityActionMetadata:n}},Ur=function(t,e){this.j=t,this.B=e},kr=function(e,n,r,i){var a,o,u,s;return t.A((function(c){switch(c.j){case 1:if(a=i){c.Na(2);break}return t.x(c,cr([n]),3);case 3:o=c.u,u=o[0],a=De(u);case 2:return t.x(c,Pr(e,a,n,r),4);case 4:return s=c.u,t.x(c,Re(ke(s.thumbnailDetails)),0)}}))},Pr=function(e,n,r,i){var a;return t.A((function(o){return 1==o.j?(i||(i=Date.now().toString()),a={id:t.tH(r,"musicTrackDownloadMetadataEntity"),playbackData:t.tH(r,"playbackData"),addedTimestampMillis:i},t.x(o,Kt(e.j,{mode:"readwrite",dc:!0},(function(e){var r=Lt(e,a,"musicTrackDownloadMetadataEntity");return e=Lt(e,n,"musicTrack"),t.mw.all([r,e])})),2)):o.return(n)}))},br=function(){rr.apply(this,arguments),this.J="musicTrack"},Hr=function(){t.vO.apply(this,arguments)};t.v(r,n),t.da.Object.defineProperties(r.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.j.entityMetadata},set:function(t){this.j.entityMetadata=t}}}),t.v(i,r),i.prototype.u=function(){return[]},t.v(a,r),a.prototype.u=function(){var e=[];return this.j.alternateChannel&&e.push(this.j.alternateChannel),this.j.alternateChannelList&&e.push.apply(e,t.u(this.j.alternateChannelList)),this.j.oneofChannelEntity&&e.push(this.j.oneofChannelEntity),[].concat(t.u(new Set(e)))},t.v(o,r),o.prototype.u=function(){var e=[];return this.j.entryCollection&&e.push(this.j.entryCollection),[].concat(t.u(new Set(e)))},t.v(u,n),u.prototype.u=function(){var e=[];return this.j.video&&e.push(this.j.video),[].concat(t.u(new Set(e)))},t.v(s,r),s.prototype.u=function(){var e=[];if(this.j.parentPlaylist&&e.push(this.j.parentPlaylist),this.j.entries)for(var n=t.t(this.j.entries),r=n.next();!r.done;r=n.next())e.push.apply(e,t.u(new u(r.value).u()));return[].concat(t.u(new Set(e)))},t.v(c,r),c.prototype.u=function(){var e=[];return this.j.descriptionEntity&&e.push(this.j.descriptionEntity),this.j.creators&&e.push.apply(e,t.u(this.j.creators)),this.j.theBiggestFan&&e.push(this.j.theBiggestFan),[].concat(t.u(new Set(e)))},t.v(E,r),E.prototype.u=function(){return[]},t.v(l,r),l.prototype.u=function(){return[]},t.v(f,r),f.prototype.u=function(){return[]},t.v(d,r),d.prototype.u=function(){return[]},t.v(_,r),_.prototype.u=function(){return[]},t.v(A,r),A.prototype.u=function(){return[]},t.v(y,r),y.prototype.u=function(){return[]},t.v(T,n),T.prototype.u=function(){var e=[];return this.j.video&&e.push(this.j.video),this.j.playlist&&e.push(this.j.playlist),this.j.videoItem&&e.push(this.j.videoItem),this.j.playlistItem&&e.push(this.j.playlistItem),[].concat(t.u(new Set(e)))},t.v(h,r),h.prototype.u=function(){var e=[];if(this.j.refresh&&e.push(this.j.refresh),this.j.downloads)for(var n=t.t(this.j.downloads),r=n.next();!r.done;r=n.next())e.push.apply(e,t.u(new T(r.value).u()));return[].concat(t.u(new Set(e)))},t.v(p,r),p.prototype.u=function(){return[]},t.v(S,r),S.prototype.u=function(){var e=[];return this.j.playbackData&&e.push(this.j.playbackData),this.j.localImageEntities&&e.push.apply(e,t.u(this.j.localImageEntities)),[].concat(t.u(new Set(e)))},t.v(R,r),R.prototype.u=function(){return[]},t.v(I,r),I.prototype.u=function(){var e=[];return this.j.fakeChildren&&e.push.apply(e,t.u(this.j.fakeChildren)),[].concat(t.u(new Set(e)))},t.v(N,r),N.prototype.u=function(){var e=[];return this.j.video&&e.push(this.j.video),this.j.playbackData&&e.push(this.j.playbackData),this.j.offlineVideoPolicy&&e.push(this.j.offlineVideoPolicy),[].concat(t.u(new Set(e)))},t.v(O,r),O.prototype.u=function(){var e=[];return this.j.channelOwner&&e.push(this.j.channelOwner),this.j.videos&&e.push.apply(e,t.u(this.j.videos)),this.j.collaboratorChannels&&e.push.apply(e,t.u(this.j.collaboratorChannels)),this.j.downloadState&&e.push(this.j.downloadState),[].concat(t.u(new Set(e)))},t.v(v,r),v.prototype.u=function(){var e=[];return this.j.video&&e.push(this.j.video),this.j.channelContributor&&e.push(this.j.channelContributor),[].concat(t.u(new Set(e)))},t.v(F,n),F.prototype.u=function(){var e=[];return this.j.localImageEntities&&e.push.apply(e,t.u(this.j.localImageEntities)),[].concat(t.u(new Set(e)))},t.v(m,n),m.prototype.u=function(){var e=[];return this.j.recommendedVideoMetadata&&e.push.apply(e,t.u(new F(this.j.recommendedVideoMetadata).u())),[].concat(t.u(new Set(e)))},t.v(L,n),L.prototype.u=function(){var e=[];return this.j.playbackPosition&&e.push(this.j.playbackPosition),[].concat(t.u(new Set(e)))},t.v(w,r),w.prototype.u=function(){var e=[];return this.j.owner&&e.push(this.j.owner),this.j.downloadState&&e.push(this.j.downloadState),this.j.userState&&e.push.apply(e,t.u(new L(this.j.userState).u())),this.j.additionalMetadata&&e.push.apply(e,t.u(new m(this.j.additionalMetadata).u())),[].concat(t.u(new Set(e)))},t.v(x,r),x.prototype.u=function(){return[]},t.v(j,r),j.prototype.u=function(){var e=[];return this.j.channelOwner&&e.push(this.j.channelOwner),this.j.playbackPosition&&e.push(this.j.playbackPosition),this.j.localImageEntities&&e.push.apply(e,t.u(this.j.localImageEntities)),this.j.downloadStatus&&e.push(this.j.downloadStatus),[].concat(t.u(new Set(e)))},t.v(D,r),D.prototype.u=function(){return[]},t.v(C,r),C.prototype.u=function(){return[]},t.v(U,r),U.prototype.u=function(){return[]},t.v(k,r),k.prototype.u=function(){return[]},t.v(P,r),P.prototype.u=function(){var e=[];return this.j.trackDownloadMetadatas&&e.push.apply(e,t.u(this.j.trackDownloadMetadatas)),[].concat(t.u(new Set(e)))},t.v(b,r),b.prototype.u=function(){var e=[];return this.j.trackDownloadMetadatas&&e.push.apply(e,t.u(this.j.trackDownloadMetadatas)),[].concat(t.u(new Set(e)))},t.v(H,r),H.prototype.u=function(){var e=[];return this.j.playbackData&&e.push(this.j.playbackData),this.j.localImageEntities&&e.push.apply(e,t.u(this.j.localImageEntities)),[].concat(t.u(new Set(e)))},t.v(M,r),M.prototype.u=function(){var e=[];return this.j.musicLibraryStatusEntity&&e.push(this.j.musicLibraryStatusEntity),this.j.primaryArtists&&e.push.apply(e,t.u(this.j.primaryArtists)),this.j.details&&e.push(this.j.details),this.j.userDetails&&e.push(this.j.userDetails),this.j.tracks&&e.push.apply(e,t.u(this.j.tracks)),this.j.share&&e.push(this.j.share),this.j.downloadMetadata&&e.push(this.j.downloadMetadata),[].concat(t.u(new Set(e)))},t.v(g,r),g.prototype.u=function(){var e=[];return this.j.albumRelease&&e.push(this.j.albumRelease),this.j.tracks&&e.push.apply(e,t.u(this.j.tracks)),[].concat(t.u(new Set(e)))},t.v(B,r),B.prototype.u=function(){var e=[];return this.j.albumRelease&&e.push(this.j.albumRelease),[].concat(t.u(new Set(e)))},t.v(V,r),V.prototype.u=function(){var e=[];return this.j.details&&e.push(this.j.details),this.j.userDetails&&e.push(this.j.userDetails),[].concat(t.u(new Set(e)))},t.v(K,r),K.prototype.u=function(){var e=[];return this.j.parentArtist&&e.push(this.j.parentArtist),[].concat(t.u(new Set(e)))},t.v(Y,r),Y.prototype.u=function(){var e=[];return this.j.parentArtist&&e.push(this.j.parentArtist),[].concat(t.u(new Set(e)))},t.v(W,r),W.prototype.u=function(){return[]},t.v(Q,r),Q.prototype.u=function(){return[]},t.v(q,r),q.prototype.u=function(){var e=[];return this.j.tracks&&e.push.apply(e,t.u(this.j.tracks)),this.j.musicLibraryStatusEntity&&e.push(this.j.musicLibraryStatusEntity),this.j.details&&e.push(this.j.details),this.j.downloadMetadata&&e.push(this.j.downloadMetadata),this.j.sideloadMetadata&&e.push(this.j.sideloadMetadata),this.j.userDetails&&e.push(this.j.userDetails),this.j.entryCollection&&e.push(this.j.entryCollection),this.j.share&&e.push(this.j.share),[].concat(t.u(new Set(e)))},t.v(G,r),G.prototype.u=function(){return[]},t.v(J,r),J.prototype.u=function(){var e=[];return this.j.musicLibraryStatusEntity&&e.push(this.j.musicLibraryStatusEntity),this.j.artists&&e.push.apply(e,t.u(this.j.artists)),this.j.audioModeVersion&&e.push(this.j.audioModeVersion),this.j.videoModeVersion&&e.push(this.j.videoModeVersion),this.j.userDetails&&e.push(this.j.userDetails),this.j.details&&e.push(this.j.details),this.j.albumRelease&&e.push(this.j.albumRelease),this.j.share&&e.push(this.j.share),this.j.libraryEdit&&e.push(this.j.libraryEdit),this.j.downloadMetadata&&e.push(this.j.downloadMetadata),[].concat(t.u(new Set(e)))},t.v(z,r),z.prototype.u=function(){var e=[];return this.j.parentTrack&&e.push(this.j.parentTrack),[].concat(t.u(new Set(e)))},t.v(X,r),X.prototype.u=function(){var e=[];return this.j.parentTrack&&e.push(this.j.parentTrack),[].concat(t.u(new Set(e)))},t.v($,r),$.prototype.u=function(){return[]},t.v(Z,r),Z.prototype.u=function(){return[]},t.v(tt,r),tt.prototype.u=function(){return[]},t.v(et,r),et.prototype.u=function(){return[]},t.v(nt,r),nt.prototype.u=function(){var e=[];return this.j.transfer&&e.push(this.j.transfer),this.j.adsPlaybackData&&e.push.apply(e,t.u(this.j.adsPlaybackData)),this.j.drmLicense&&e.push(this.j.drmLicense),this.j.offlineVideoPolicy&&e.push(this.j.offlineVideoPolicy),[].concat(t.u(new Set(e)))},t.v(rt,r),rt.prototype.u=function(){return[]},t.v(it,r),it.prototype.u=function(){var e=[];return this.j.offlineVideoStreams&&e.push.apply(e,t.u(this.j.offlineVideoStreams)),this.j.captionTrack&&e.push.apply(e,t.u(this.j.captionTrack)),[].concat(t.u(new Set(e)))},t.v(at,r),at.prototype.u=function(){return[]},t.v(ot,r),ot.prototype.u=function(){return[]},t.v(ut,r),ut.prototype.u=function(){return[]},t.v(st,r),st.prototype.u=function(){return[]},t.v(ct,r),ct.prototype.u=function(){return[]},t.v(Et,r),Et.prototype.u=function(){return[]};var Mr,gr=["browse","music/browse","unplugged/browse"],Br=["offline/playlist_sync_check"],Vr=["offline"],Kr=["offline/get_playback_data_entity"];ft.getInstance=function(){return t.A((function(e){return e.return(new Promise((function(e){t.Lw().then((function(t){t?(ft.j||(ft.j=new ft(t)),e(ft.j)):e(void 0)}))})))}))},ft.prototype.get=function(e){var n,r,i,a=this;return t.A((function(o){return 1==o.j?t.x(o,lt(a.token),2):3!=o.j?(n=o.u,t.x(o,n.get("prefs",e),3)):(r=o.u)?(i=(0,t.T)(),r.expirationTimestampMs<=i?o.return():o.return(r.value)):o.return()}))},ft.prototype.set=function(e,n,r){r=void 0===r?31536e3:r;var i,a,o,u=this;return t.A((function(s){return 1==s.j?(i=(0,t.T)(),a={key:e,value:n,expirationTimestampMs:i+1e3*r},t.x(s,lt(u.token),2)):(o=s.u,t.x(s,t.sna(o,"prefs",a),0))}))},ft.prototype.remove=function(e){var n,r=this;return t.A((function(i){return 1==i.j?t.x(i,lt(r.token),2):(n=i.u,t.x(i,n.delete("prefs",e),0))}))},t.v(At,t.aw),t.v(Nt,St),Nt.prototype.B=function(t,e){return e=It(e),t=(new TextEncoder).encode(JSON.stringify(t)),this.j.encrypt(t,e)},Nt.prototype.u=function(t,e){if(!(t instanceof Uint8Array))throw yt(1);var n=new TextDecoder;return e=It(e),t=this.j.decrypt(t,e),JSON.parse(n.decode(t))};var Yr={buttonEntity:ot,captionTrack:$,channelHandle:i,commerceCartListEntity:st,downloadQualityPickerEntity:_,downloadsPageRefreshTokenEntity:y,downloadsPageViewConfigurationEntity:D,downloadStatusEntity:A,fakeChannel:a,fakePlaylist:o,fakePlaylistEntryCollection:s,fakeVideo:c,fakeVideoDescription:E,flowStateEntity:l,iconBadgeEntity:ct,liveChatPollStateEntity:d,logoEntity:f,macroMarkerEntity:C,mainDownloadsListEntity:h,mainPlaylistDownloadStateEntity:p,mainPlaylistEntity:O,mainPlaylistVideoEntity:v,mainVideoDownloadStateEntity:S,mainVideoEntity:w,markersVisibilityOverrideEntity:U,musicAlbumReleaseDetail:g,musicAlbumReleaseDownloadMetadataEntity:P,musicAlbumRelease:M,musicAlbumReleaseUserDetail:B,musicArtistDetail:K,musicArtist:V,musicArtistUserDetail:Y,musicLibraryEdit:W,musicLibraryStatusEntity:Q,musicPlaylist:q,musicPlaylistDownloadMetadataEntity:b,musicShare:G,musicTrackDetail:z,musicTrackDownloadMetadataEntity:H,musicTrack:J,musicTrackUserDetail:X,offlineOrchestrationActionWrapperEntity:Z,offlineVideoPolicy:tt,offlineVideoStreams:et,offlineabilityEntity:R,orchestrationWebSamplingEntity:I,pinnedProductEntity:k,playbackData:nt,quantityIncrementerEntity:Et,refresh:rt,settingEntity:at,transfer:it,videoPlaybackPositionEntity:ut,ytMainChannelEntity:x,ytMainDownloadedVideoEntity:N,ytMainVideoEntity:j};t.v(Mt,St),Mt.prototype.B=function(t){return t},Mt.prototype.u=function(t){if(t instanceof Uint8Array)throw yt(0);return t},t.v(Vt,t.L),Vt.prototype.B=function(t){Jt(this,t.data)},Vt.prototype.ra=function(){this.channel.close()};var Wr,Qr={yga:"captionTrack",ooa:"ytMainDownloadedVideoEntity",poa:"ytMainVideoEntity",ppa:"downloadStatusEntity",dFa:"ytMainChannelEntity",eFa:"mainPlaylistEntity",fFa:"mainPlaylistDownloadStateEntity",gFa:"mainPlaylistVideoEntity",hFa:"mainVideoEntity",iFa:"mainVideoDownloadStateEntity",LIa:"musicAlbumReleaseDetail",MIa:"musicAlbumReleaseDownloadMetadataEntity",NIa:"musicAlbumRelease",OIa:"musicAlbumReleaseUserDetail",PIa:"musicArtistDetail",QIa:"musicArtist",SIa:"musicArtistUserDetail",bJa:"musicLibraryEdit",cJa:"musicLibraryStatusEntity",iJa:"musicPlaylistDownloadMetadataEntity",jJa:"musicPlaylist",oJa:"musicShare",tJa:"musicTrackDetail",uJa:"musicTrackDownloadMetadataEntity",vJa:"musicTrack",wJa:"musicTrackUserDetail",KKa:"offlineOrchestrationActionWrapperEntity",KMa:"offlineVideoPolicy",dNa:"offlineVideoStreams",qPa:"playbackData",TSa:"orchestrationWebSamplingEntity",vTa:"settingEntity",cXa:"downloadsPageViewConfigurationEntity",dXa:"refresh",eXa:"mainDownloadsListEntity",fXa:"downloadsPageRefreshTokenEntity",O_a:"transfer"},qr=new t.cp("elementsCommand"),Gr=new t.cp("entityBatchUpdate"),Jr=new t.cp("downloadStatusEntity"),zr=new t.cp("mainPlaylistEntityActionMetadata"),Xr=new t.cp("mainVideoEntityActionMetadata"),$r=new t.cp("musicPlaylistEntityActionMetadata"),Zr=new t.cp("musicTrackEntityActionMetadata"),ti=new t.cp("offlineOrchestrationActionCommand"),ei=new t.cp("localImageEntityActionMetadata"),ni=new t.cp("playbackDataActionMetadata"),ri=new t.cp("transferEntityActionMetadata");t.v(ae,t.L),ae.prototype.B=function(t){this.api.Pa("onOfflineOperationFailure",t.data)},ae.prototype.C=function(t){this.api.ma("offlinetransferpause",t.data)},ae.prototype.ra=function(){var t,e;null==(t=this.j)||t.close(),null==(e=this.u)||e.close()},ue.prototype.request=function(t,e,n){return e=void 0===e?{}:e,this.locks.request(t,e,(function(t){return n(t)}))},se.prototype.Hf=function(){this.j&&Ee(this)};var ii,ai,oi=t.D.caches;Ae.prototype.open=function(t){return oi.open(Te(t))},Ae.prototype.has=function(t){return oi.has(Te(t))},Ae.prototype.delete=function(t){return oi.delete(Te(t))},Ae.prototype.match=function(e,n){var r,i,a,o,u,s,c=this;return t.A((function(E){switch(E.j){case 1:return t.x(E,c.keys(),2);case 2:r=E.u,i=t.t(r),a=i.next();case 3:if(a.done){E.Na(5);break}return o=a.value,t.x(E,c.open(o),6);case 6:return u=E.u,t.x(E,u.match(e,n),7);case 7:if(s=E.u)return E.return(s);a=i.next(),E.Na(3);break;case 5:return E.return()}}))},t.v(ye,Ae),ye.prototype.keys=function(){var e,n,r,i,a,o,u,s;return t.A((function(c){if(1==c.j)return e=[],n=t.bw("CacheStorage keys"),t.x(c,oi.keys(),2);for(r=c.u,i=t.t(r),a=i.next();!a.done;a=i.next()){var E=(o=a.value).indexOf(":");u=-1===E?{oE:o}:{oE:o.substring(0,E),datasyncId:o.substring(E+1)},s=u.oE,u.datasyncId===n&&e.push(s)}return c.return(e)}))},Object.keys(Qr).map((function(t){return Qr[t]}));var ui="captionTrack ytMainDownloadedVideoEntity ytMainVideoEntity ytMainChannelEntity mainPlaylistEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer".split(" "),si="musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer".split(" ");t.v(qe,Ye),qe.prototype.u=function(e){return Ne(e)?Ge(this,e):Oe(e)?function(e,n){var r,i,a,o,u,s,c,E,l,f,d,_,A,y,T,h,p;return t.A((function(S){switch(S.j){case 1:return r=n.entityKey,t.x(S,Kt(e.j,{mode:"readonly",dc:!0},(function(e){var i=Ft(e,r,"playbackData"),a=Ft(e,t.tH(t.sH(n.entityKey).entityId,"offlineVideoPolicy"),"offlineVideoPolicy");return e=Ft(e,t.tH(t.sH(n.entityKey).entityId,"transfer"),"transfer"),t.mw.all([i,a,e])})),2);case 2:return i=S.u,a=t.t(i),o=a.next().value,u=a.next().value,s=a.next().value,E=u,l=s,(c=o)&&E?(f={lastPlayerResponseTimestampSeconds:c.playerResponseTimestamp,offlineToken:E.offlineToken},d={},null!=(_=l)&&_.maximumDownloadQuality&&(d.maximumDownloadQuality=l.maximumDownloadQuality),t.pa(S,3),t.x(S,Je(e,r,{refreshData:f,uU:d}),5)):S.return(Xe(n,!0));case 5:return(A=S.u)?t.x(S,ze(e,A,n),6):(y=Ie(n)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",S.return(Xe(n,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",y)));case 6:return S.return(Xe(n,!0,A.orchestrationActions));case 3:return T=t.ta(S),h="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",p="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof t.fw&&"QUOTA_EXCEEDED"===T.type&&(h="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",p="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),S.return(Xe(n,!1,void 0,h,p))}}))}(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))},t.v($e,Ye),$e.prototype.u=function(e){return Ne(e)?function(e,n){var r;return t.A((function(i){switch(i.j){case 1:return r=Ie(n),t.x(i,qt(e.j,n.entityKey,"transfer"),2);case 2:return i.u?i.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r)):(t.pa(i,3),t.x(i,Ze(e,n),5));case 5:t.ra(i,4);break;case 3:return t.ta(i),i.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return i.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r))}}))}(this,e):Oe(e)?function(e,n){var r,i;return t.A((function(a){switch(a.j){case 1:return r=Ie(n),t.x(a,qt(e.j,n.entityKey,"transfer"),2);case 2:return(i=a.u)&&"TRANSFER_STATE_COMPLETE"===i.transferState?(t.pa(a,3),t.x(a,Ze(e,n,!0),5)):a.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));case 5:t.ra(a,4);break;case 3:return t.ta(a),a.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return a.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r))}}))}(this,e):"OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"===e.actionType&&e.entityKey?this.handleUpdate(e):Promise.reject(Error("Unsupported action type: "+e.actionType))},$e.prototype.handleUpdate=function(e){var n,r,i,a=this;return t.A((function(o){switch(o.j){case 1:return n=Ie(e),t.x(o,qt(a.j,e.entityKey,"transfer"),2);case 2:return(r=o.u)&&"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"===r.transferState?(t.pa(o,3),r.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",t.x(o,Wt(a.j,r,"transfer"),5)):o.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));case 5:i=t.sH(r.key).entityId,fe({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:i,Wj:r}),t.ra(o,4);break;case 3:return t.ta(o),o.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return o.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n))}}))};var ci,Ei=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];fn.prototype.j=function(t,e){var n=t.action.actionMetadata.priority-e.action.actionMetadata.priority;return 0===n&&(t.j<e.j?n=-1:t.j>e.j&&(n=1)),n},t.v(An,t.L),An.prototype.ra=function(){this.J&&this.J(),t.L.prototype.ra.call(this)},An.prototype.createAction=function(e,n){var r=t.sH(e.entityKey).entityType,i=t.wz(16);return new en(r,i,e,n.actionId,n.rootActionId)},An.prototype.ea=function(e){var n,r,i,a,o,u,s,c,E,l=this;return t.A((function(f){if(1==f.j){if(l.isDisposed())return f.return();for(r=null!=(n=e.offlineOrchestrationActionWrapperEntity)?n:new Set,i=[],a=t.t(r),o=a.next();!o.done;o=a.next())u=o.value,s=t.sH(u),c=s.entityId,_n(l.j,c)||i.push(u);return t.x(f,Nn(l,i),2)}return E=f.u,t.x(f,hn(l,E),0)}))},An.prototype.retry=function(){var e=this;return t.A((function(n){return t.x(n,function(e){var n,r,i,a,o,u,s;return t.A((function(c){if(1==c.j)return t.x(c,Nn(e),2);for(n=c.u,r=[],i=t.t(n),a=i.next();!a.done;a=i.next())o=a.value,u=t.sH(o.key),s=u.entityId,_n(e.j,s)||r.push(o);return t.x(c,hn(e,r),0)}))}(e),0)}))},t.k=wn.prototype,t.k.t2=function(e){var n,r,i,a=this;return t.A((function(o){if(!t.W(e.state,128))return o.Na(0);var u=null==(n=e.state.getData())?void 0:n.errorCode;e.state.getData();var s=null==(r=e.state.getData())?void 0:r.IC;return i="net.connect"===u&&1===s?"TRANSFER_FAILURE_REASON_NETWORK_LOST":null!=u&&u.startsWith("net.")?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL",t.x(o,a.Ht(a.player.getVideoData().videoId,i),0)}))},t.k.Ht=function(e,n){var r=this;return t.A((function(i){return 1==i.j?r.u?i.return():(r.u=!0,"TRANSFER_FAILURE_REASON_NETWORK_LOST"===n?(Dn(r,e,!1,!0),i.Na(0)):t.x(i,jn(r,e),3)):(t.zH(e,4),t.x(i,r.j.Ht(n),0))}))},t.k.gE=function(e){2===e.status?(e.status!==this.B&&(Vn(this.j),t.zH(e.videoId,2)),e.GA&&Qn(this.j,e.videoId,e.GA)):4===e.status?(jn(this,e.videoId),this.Ht(e.videoId,e.uD?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):1===e.status&&Wn(this.j),this.B=e.status,this.api.Pa("localmediachange",{videoId:e.videoId,status:e.status})},t.k.kK=function(){var e,n=this;return t.A((function(r){return 1==r.j?n.u?r.return():(n.u=!0,e=n.player.getVideoData().videoId,t.x(r,jn(n,e),2)):t.x(r,n.j.kK(),0)}))},t.k.N=function(t){return this.api.V().N(t)},t.v(Un,t.L),Un.prototype.ra=function(){this.u&&this.u(),t.L.prototype.ra.call(this)},Un.prototype.B=function(e){var n,r,i,a,o,u,s,c,E=this;return t.A((function(l){for(r=null!=(n=e.transfer)?n:new Set,i=[],a=t.t(r),o=a.next();!o.done;o=a.next())u=o.value,s=t.sH(u),c=s.entityId,i.push(c);return 0===i.length?l.return():t.x(l,kn(E,i),0)}))},t.v(bn,t.L),t.k=bn.prototype,t.k.ra=function(){this.J&&this.J(),this.S.dispose(),this.C.dispose(),this.oa&&t.Kf(this.F.B,this.oa),this.ea&&t.Kf(this.F.B,this.ea),t.L.prototype.ra.call(this)},t.k.L4=function(e){var n,r,i=this;return t.A((function(a){if(1==a.j)return n=t.tH(e,"transfer"),i.j&&n===i.j.key?(Dn(i.I,i.B,!0),i.C.stop(),a.Na(0)):t.x(a,Kt(i.u,{mode:"readwrite",dc:!0},(function(t){return Ft(t,n,"transfer").then((function(e){if(e&&"TRANSFER_STATE_COMPLETE"!==e.transferState&&"TRANSFER_STATE_FAILED"!==e.transferState)return e.transferState="TRANSFER_STATE_PAUSED_BY_USER",Lt(t,e,"transfer").then((function(){return e}))}))})),3);(r=a.u)&&_e({videoId:e,Wj:r}),t.oa(a)}))},t.k.K4=function(){this.j&&this.B&&Dn(this.I,this.B,!1),this.C.stop()},t.k.QA=function(){this.j?gn(this,this.j):Hn(this)},t.k.GV=function(e){var n,r=this;return t.A((function(i){switch(i.j){case 1:if(!r.j){i.Na(2);break}if("TRANSFER_STATE_COMPLETE"===r.j.transferState||"TRANSFER_STATE_FAILED"===r.j.transferState||!e.transfer||!e.transfer.has(r.j.key)){i.Na(3);break}return n=r,t.x(i,qt(r.u,r.j.key,"transfer"),4);case 4:if(n.j=i.u,r.j){i.Na(3);break}return t.x(i,function(e){return t.A((function(n){if(1==n.j)return e.B?t.x(n,jn(e.I,e.B.videoDetails.videoId),3):n.Na(0);Xn(e),t.oa(n)}))}(r),3);case 3:if(r.j)return i.return();case 2:return t.x(i,Hn(r),0)}}))},t.k.Ht=function(e,n){var r,i,a,o,u=this;return t.A((function(s){if(1==s.j){if(!u.j)return tr(u,"onTransferFailure: "+e),s.Na(2);r=u.j;t:switch(e){case"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case"TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case"TRANSFER_FAILURE_REASON_PLAYABILITY":case"TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var c=!1;break t;default:c=!0}return c&&qn(u)?t.x(s,Jn(u,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),6):t.x(s,Gn(u,e),2)}2!=s.j&&(a=null!=(i=r)&&i.key?t.sH(r.key).entityId:"",fe({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:a,Wj:r})),Xn(u),o=Hn(u,!0),n&&n(o),t.oa(s)}))},t.k.kK=function(e){var n,r,i,a,o,u,s,c=this;return t.A((function(E){return 1==E.j?c.j?qn(c)?t.x(E,Jn(c,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),6):t.x(E,Gn(c,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),2):(tr(c,"onMaybeTransferStreamsExpired"),E.Na(2)):2!=E.j?(c.j||tr(c,"onMaybeTransferStreamsExpiredRetryAttempting"),n=c.j,i=null!=(r=n)&&r.key?t.sH(n.key).entityId:"",fe({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:i,Wj:n}),ne(a={priority:1,retryScheduleIntervalsInSeconds:[1,2,4]},ni,{isEnqueuedForExpiredStreamUrlRefetch:!0}),o=t.tH(i,"playbackData"),u=nn(new en("playbackData",i,{actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:o,actionMetadata:a})),t.x(E,Wt(c.u,u,"offlineOrchestrationActionWrapperEntity"),2)):(Xn(c),s=Hn(c,!0),e&&e(s),void t.oa(E))}))};var li={},fi=(li.TRANSFER_STATE_TRANSFERRING=1,li.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,li);t.k=rr.prototype,t.k.qz=function(t){var e={};return e.playbackData=new qe(t,this.Y,this.j),e.transfer=new $e(t),e},t.k.iL=function(){var e=this;return t.A((function(n){return e.u?t.x(n,function(e){return t.A((function(n){if(1==n.j)n=t.x(n,te(),2);else{var r=e.S,i=t.xH();i=Object.keys(i),r=kn(r,i),n=t.x(n,r,0)}return n}))}(e.u),0):n.Na(0)}))},t.k.isOrchestrationLeader=function(){return this.B.j},t.k.EK=function(t){var e,n=this.j;n.api.ma("offlinetransferpause",t),null==(e=n.u)||e.postMessage(t)},t.k.QA=function(e){var n,r;return t.A((function(i){return 1==i.j?t.x(i,zt(),2):(n=i.u)?(r=t.tH(e,"transfer"),t.x(i,Kt(n,{mode:"readwrite",dc:!0},(function(n){return Ft(n,r,"transfer").then((function(r){return r&&"TRANSFER_STATE_PAUSED_BY_USER"===r.transferState?(r.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Lt(n,r,"transfer").then((function(){return fe({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",statusType:"USER_RESUMED"},{videoId:e,Wj:r}),t.mw.resolve(null)}))):t.mw.resolve(null)}))})),0)):i.return()}))},t.k.JE=function(e){e=void 0===e?43200:e;var n,r,i,a,o,u,s,c,E=this;return t.A((function(l){if(1==l.j)return E.S.hh()?t.x(l,zt(),2):l.return(function(){var e,n,r,i,a,o;return t.A((function(u){switch(u.j){case 1:return t.x(u,zt(),2);case 2:return(e=u.u)?(n=Date.now()/1e3,t.x(u,Gt(e,"offlineVideoPolicy"),3)):u.return([]);case 3:r=u.u,i=t.t(r),a=i.next();case 4:if(a.done){u.Na(6);break}if(!((o=a.value).expirationTimestamp&&Number(o.expirationTimestamp)<n)){u.Na(5);break}return o.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE",t.x(u,Wt(e,o,"offlineVideoPolicy"),5);case 5:a=i.next(),u.Na(4);break;case 6:return u.return(r.map((function(t){return t.key})))}}))}());if(3!=l.j)return(n=l.u)?(r=Date.now()/1e3,t.x(l,Gt(n,"offlineVideoPolicy"),3)):l.return([]);for(i=l.u,a=[],o=t.t(i),u=o.next();!u.done;u=o.next())s=u.value,Number(s.lastUpdatedTimestampSeconds)+e<=r&&(c=t.sH(s.key).entityId,a.push(c));return a.length?l.return(sr(E,a,E.J,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):l.return([])}))},t.k.deleteAll=function(){return sr(this,["!*$_ALL_ENTITIES_!*$"],this.J,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE")},t.k.refreshAllStaleEntities=function(e){var n=this;return t.A((function(r){return 1==r.j?t.x(r,n.JE(e),2):r.return(r.u)}))},t.k.yH=function(){return t.A((function(t){return t.return([])}))},t.v(_r,Ye),_r.prototype.u=function(e){return Ne(e)?function(e,n){var r,i,a,o,u,s,c,E,l,f,d,_,A,y;return t.A((function(T){switch(T.j){case 1:return r=Ie(n),i=t.sH(n.entityKey),a=i.entityId,o=[],t.pa(T,2),t.x(T,Ar(e,a),4);case 4:o=T.u,t.ra(T,3);break;case 2:return u=t.ta(T),s="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof t.fw&&"QUOTA_EXCEEDED"===u.type&&(s="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),T.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,s,c));case 3:if(E=[],null!=(l=o)&&l.length)for(f=t.t(o),d=f.next();!d.done;d=f.next())_=d.value,A=_.offlineVideoData,null!=(y=A)&&y.videoId&&E.push(We("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",A.videoId,"mainVideoEntity",0,di,Sr(n,A)));return T.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,E))}}))}(this,e):Oe(e)?function(e,n){var r,i,a,o,u,s,c,E,l,f,d,_,A,y,T,h,p,S,R,I,N,O,v,F,m,L,w,x,j,D,C,U,k,P,b,H,M,g,B,V,K,Y,W,Q,q,G,J,z,X,$,Z,tt,et,nt,rt,it,at,ot,ut,st,ct,Et,lt,ft,dt,_t,At,yt,Tt;return t.A((function(ht){switch(ht.j){case 1:return r=Ie(n),i=n.entityKey,a=t.sH(i).entityId,o=[],u=!1,"!*$_ALL_ENTITIES_!*$"===a?(u=!0,t.x(ht,Gt(e.j,"mainPlaylistEntity"),5)):t.x(ht,qt(e.j,i,"mainPlaylistEntity"),4);case 4:(s=ht.u)&&o.push(s),ht.Na(3);break;case 5:o=ht.u;case 3:if(null==(c=o)||!c.length)return ht.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));if(E=t.S(n.actionMetadata,zr),f=null==(l=E)?void 0:l.nextAutoRefreshIntervalSeconds,_=null==(d=E)?void 0:d.autoSync,A=[],T=y=!0,h=!1,!u&&!1===_){ht.Na(6);break}return t.x(ht,lr(0,!!_,!0,o),7);case 7:if(!(A=ht.u).length||!u&&A[0].playlistId!==a)return ht.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));case 6:if(u){for(p=[],S=t.t(A),R=S.next();!R.done;R=S.next())(I=R.value).upToDate||_&&!I.shouldAutoSyncMetadata||!I.playlistId||(N={nextAutoRefreshIntervalSeconds:I.checkInSeconds,autoSync:_},p.push(We("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",I.playlistId,"mainPlaylistEntity",0,di,{mainPlaylistEntityActionMetadata:N})));return ht.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,p))}if(A.length&&(O=A[0],h=!!O.upToDate,_&&(y=null==(v=O.shouldAutoSyncMetadata)||v,T=null==(F=O.shouldAutoSyncVideos)||F,O.checkInSeconds&&(f=O.checkInSeconds))),h||!y)return ht.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));if(m=[],!(L=o[0]).downloadState){w=void 0,ht.Na(8);break}return t.x(ht,qt(e.j,L.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:w=ht.u;case 8:return D=null!=(j=x=w)&&j.addedTimestampMillis?String(x.addedTimestampMillis):void 0,t.pa(ht,10),t.x(ht,Ar(e,a,D,f),12);case 12:m=ht.u,t.ra(ht,11);break;case 10:return(C=t.ta(ht))instanceof Error&&"No data"===C.message?t.x(ht,me(a,e.j,n,e.B),11):(U="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",C instanceof t.fw&&"QUOTA_EXCEEDED"===C.type&&(U="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ht.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,U,k)));case 11:if(!T)return ht.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));if(P=[],b=new Map,null!=(H=m)&&H.length)for(M=t.t(m),g=M.next();!g.done;g=M.next())B=g.value,V=B.offlineVideoData,null!=(K=V)&&K.videoId&&b.set(V.videoId,V);if(Y=new Map,W=[],null!=(Q=L)&&null!=(q=Q.videos)&&q.length)for(G=t.t(L.videos),J=G.next();!J.done;J=G.next())z=J.value,X=JSON.parse(t.sH(z).entityId),($=X.videoId)&&(b.has($)?(Y.set($,b.get($)),b.delete($)):W.push($));for(Z=t.t(b.entries()),tt=Z.next();!tt.done;tt=Z.next())et=tt.value,nt=t.t(et),rt=nt.next().value,it=nt.next().value,at=rt,ot=it,P.push(We("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",at,"mainVideoEntity",0,di,Sr(n,ot)));for(ut=t.t(Y.entries()),st=ut.next();!st.done;st=ut.next())ct=st.value,Et=t.t(ct),lt=Et.next().value,ft=Et.next().value,dt=lt,_t=ft,P.push(We("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",dt,"mainVideoEntity",0,di,Sr(n,_t)));for(At=t.t(W),yt=At.next();!yt.done;yt=At.next())Tt=yt.value,P.push(We("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Tt,"mainVideoEntity",0,di));return ht.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,P))}}))}(this,e):ve(e)?function(e,n){var r,i;return t.A((function(a){switch(a.j){case 1:return r=Ie(n),t.pa(a,2),"!*$_ALL_ENTITIES_!*$"===(i=t.sH(n.entityKey).entityId)?t.x(a,Le(e.j,n,e.B),5):t.x(a,me(i,e.j,n,e.B),5);case 5:t.ra(a,3);break;case 2:return t.ta(a),a.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return a.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r))}}))}(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};var di=[10];t.v(Rr,Ye),Rr.prototype.u=function(e){return Ne(e)?function(e,n){var r,i,a,o,u,s,c,E;return t.A((function(l){switch(l.j){case 1:return r=Ie(n),i=t.sH(n.entityKey),a=i.entityId,t.pa(l,2),t.x(l,Ir(e,a,void 0,null==(o=t.S(n.actionMetadata,Xr))?void 0:o.offlineVideoData),4);case 4:t.ra(l,3);break;case 2:return u=t.ta(l),s="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof t.fw&&"QUOTA_EXCEEDED"===u.type&&(s="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),l.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,s,c));case 3:var f=(f=t.S(n.actionMetadata,Xr))?{playbackDataActionMetadata:{maximumDownloadQuality:f.maximumDownloadQuality}}:void 0;return E=We("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a,"playbackData",1,_i,f),l.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,[E]))}}))}(this,e):Oe(e)?function(e,n){var r,i,a,o,u,s,c,E,l,f,d;return t.A((function(_){switch(_.j){case 1:return r=Ie(n),i=t.sH(n.entityKey),a=i.entityId,t.x(_,qt(e.j,n.entityKey,"mainVideoEntity"),2);case 2:if(!(o=_.u)){u=void 0,_.Na(3);break}return t.x(_,qt(e.j,o.downloadState,"mainVideoDownloadStateEntity"),4);case 4:u=_.u;case 3:return s=u,o&&s?(t.pa(_,5),t.x(_,Ir(e,a,s.addedTimestampMillis,null==(E=t.S(n.actionMetadata,Xr))?void 0:E.offlineVideoData),7)):_.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));case 7:c=We("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",a,"playbackData",1,_i),t.ra(_,6);break;case 5:return(l=t.ta(_))instanceof Error&&"No data"===l.message?t.x(_,Fe(a,e.j,n,e.B),6):(f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof t.fw&&"QUOTA_EXCEEDED"===l.type&&(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),_.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,f,d)));case 6:return _.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,c?[c]:void 0))}}))}(this,e):ve(e)?function(e,n){var r,i;return t.A((function(a){switch(a.j){case 1:return r=Ie(n),t.pa(a,2),"!*$_ALL_ENTITIES_!*$"===(i=t.sH(n.entityKey).entityId)?t.x(a,Le(e.j,n,e.B),5):t.x(a,Fe(i,e.j,n,e.B),5);case 5:t.ra(a,3);break;case 2:return t.ta(a),a.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return a.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r))}}))}(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};var _i=[10];t.v(Or,Ye),Or.prototype.u=function(e){return Oe(e)?function(e,n){var r,i,a,o,u,s,c,E,l,f,d,_,A,y,T,h,p,S,R,I,N,O;return t.A((function(v){switch(v.j){case 1:return r=Ie(n),i=[],t.x(v,ft.getInstance(),2);case 2:if(!(a=v.u)){v.Na(3);break}return t.x(v,a.get("sdois"),4);case 4:o=v.u;case 3:if(!e.Y.N("kevlar_smart_downloads")){v.Na(5);break}if(t.pa(v,6),void 0===o)throw Error("prefStorage or opt-in state is undefined");return t.x(v,Ke(e.j),8);case 8:if((u=v.u).reverse(),!u.length){v.Na(9);break}s=t.t(u),c=s.next();case 10:if(c.done){v.Na(9);break}if(!(E=c.value)){v.Na(11);break}return l=t.sH(E).entityId,t.x(v,Fe(l,e.j,{entityKey:E,actionType:n.actionType},e.B),11);case 11:c=s.next(),v.Na(10);break;case 9:return t.x(v,fr(o),14);case 14:return f=v.u,t.x(v,Be(f),15);case 15:if(d=Ve(f),null!=(_=d)&&_.length)for(A=t.t(d),y=A.next();!y.done;y=A.next())h=T=y.value,p=h.actionType,S=h.entityKey,R=h.actionMetadata,p&&S&&R&&!t.S(R,ei)&&i.push(T);t.ra(v,5);break;case 6:return I=t.ta(v),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",I instanceof t.fw&&"QUOTA_EXCEEDED"===I.type&&(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),v.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,N,O));case 5:return v.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,i))}}))}(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))},t.v(vr,rr),vr.prototype.qz=function(t){var e=rr.prototype.qz.call(this,t);return e.mainVideoEntity=new Rr(t,this.j),e.mainPlaylistEntity=new _r(t,this.j),e.mainDownloadsListEntity=new Or(t,this.Y,this.j),e},vr.prototype.refreshAllStaleEntities=function(e,n){var r,i,a,o,u,s,c,E,l=this;return t.A((function(f){switch(f.j){case 1:if(r=[],!l.Y.N("web_player_offline_playlist_auto_refresh")){f.Na(2);break}return t.x(f,Fr(l,e,n),3);case 3:r=f.u;case 2:return t.x(f,ft.getInstance(),4);case 4:return i=f.u,t.x(f,null==(a=i)?void 0:a.get("sdois"),5);case 5:if(o=f.u,!l.Y.N("kevlar_smart_downloads")||!o){f.Na(6);break}return s=(u=r).concat,t.x(f,mr(l,o,0===e),7);case 7:r=s.call(u,f.u);case 6:return E=(c=r).concat,t.x(f,rr.prototype.refreshAllStaleEntities.call(l,e,n),8);case 8:return r=E.call(c,f.u),f.return(r)}}))},vr.prototype.iL=function(){var e=this;return t.A((function(n){return 1==n.j?t.x(n,rr.prototype.iL.call(e),2):e.Y.N("woffle_entity_migration")?t.x(n,function(e){var n;return t.A((function(r){return 1==r.j?t.x(r,zt(),2):(n=r.u)?t.x(r,Kt(n,{mode:"readwrite",dc:!0},(function(n){var r=mt(n,"ytMainDownloadedVideoEntity"),i=mt(n,"ytMainVideoEntity"),a=mt(n,"mainVideoEntity");return t.mw.all([r,i,a]).then((function(r){var i=(r=t.t(r)).next().value,a=r.next().value,o=r.next().value;if(r={},i.length)for(var u=(i=t.t(i)).next();!u.done;u=i.next()){u=u.value;var s=t.sH(u.id).entityId;r[s]=u}if(i={},a.length)for(u=(a=t.t(a)).next();!u.done;u=a.next())u=u.value,i[s=t.sH(u.id).entityId]=u;for(a={},u=(o=t.t(o)).next();!u.done;u=o.next())u=u.value,a[s=t.sH(u.key).entityId]=u;for(o=[],s=(u=t.t(Object.keys(r))).next();!s.done;s=u.next()){if(!a[s=s.value]&&i[s]){var c=r[s],E=i[s];c={key:t.tH(s,"mainVideoDownloadStateEntity"),playbackData:t.tH(s,"playbackData"),addedTimestampMillis:c.addedTimestampMillis},E=[{key:t.tH(s,"mainVideoEntity"),videoId:s,title:E.title,thumbnail:E.thumbnail,localizedStrings:E.localizedStrings,lengthSeconds:E.lengthSeconds,publishedTimestampMillis:E.publishedTimestampMillis,formattedDescription:E.formattedDescription,owner:E.channelOwner,downloadState:c.key},c],o.push(Lt(n,E[0],"mainVideoEntity"),Lt(n,E[1],"mainVideoDownloadStateEntity"))}e.Y.N("woffle_clean_up_after_entity_migration")&&(c=void 0,E=null==(c=r[s])?void 0:c.id,c=void 0,s=null==(c=i[s])?void 0:c.id,(E||s)&&re("Remove remaining deprecated offline entity."),E&&o.push(xt(n,E)),s&&o.push(xt(n,s)))}return t.mw.all(o)}))})),0):r.return()}))}(e),0):n.Na(0)}))},vr.prototype.yH=function(){var e,n,r,i,a,o,u,s=this;return t.A((function(c){switch(c.j){case 1:if(!s.Y.N("woffle_undo_delete")){c.Na(2);break}return t.x(c,zt(),3);case 3:return(e=c.u)?t.x(c,Gt(e,"downloadStatusEntity"),4):c.return([]);case 4:for(n=c.u,r=[],i=t.t(n),a=i.next();!a.done;a=i.next())"DOWNLOAD_STATE_USER_DELETED"===(o=a.value).downloadState&&o.key&&(u=t.sH(o.key).entityId,r.push(u));if(r.length)return c.return(sr(s,r,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"));case 2:return c.return([])}}))},t.v(Lr,Ye),Lr.prototype.u=function(e){return Ne(e)?function(e,n){var r,i,a,o,u,s,c,E,l,f,d,_,A,y;return t.A((function(T){switch(T.j){case 1:return r=Ie(n),i=t.sH(n.entityKey),a=i.entityId,o=[],t.pa(T,2),t.x(T,xr(e,a),4);case 4:o=T.u,t.ra(T,3);break;case 2:return u=t.ta(T),s="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof t.fw&&"QUOTA_EXCEEDED"===u.type&&(s="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),T.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,s,c));case 3:if(E=[],null!=(l=o)&&l.length)for(f=t.t(o),d=f.next();!d.done;d=f.next())_=d.value,A=_.offlineVideoData,null!=(y=A)&&y.videoId&&E.push(We("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",A.videoId,"musicTrack",0,Ai,Cr(n,A)));return T.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,E))}}))}(this,e):Oe(e)?wr(this,e):ve(e)?function(e,n){var r,i;return t.A((function(a){switch(a.j){case 1:return r=Ie(n),t.pa(a,2),"!*$_ALL_ENTITIES_!*$"===(i=t.sH(n.entityKey).entityId)?t.x(a,je(e.j,n,e.B),5):t.x(a,xe(i,e.j,n,e.B),5);case 5:t.ra(a,3);break;case 2:return t.ta(a),a.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return a.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r))}}))}(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};var Ai=[10];t.v(Ur,Ye),Ur.prototype.u=function(e){return Ne(e)?function(e,n){var r,i,a,o,u,s,c,E;return t.A((function(l){switch(l.j){case 1:return r=Ie(n),i=t.sH(n.entityKey),a=i.entityId,t.pa(l,2),t.x(l,kr(e,a,void 0,null==(o=t.S(n.actionMetadata,Zr))?void 0:o.track),4);case 4:t.ra(l,3);break;case 2:return u=t.ta(l),s="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof t.fw&&"QUOTA_EXCEEDED"===u.type&&(s="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),l.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,s,c));case 3:var f=(f=t.S(n.actionMetadata,Zr))?{playbackDataActionMetadata:{maximumDownloadQuality:f.maximumDownloadQuality}}:void 0;return E=We("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a,"playbackData",1,yi,f),l.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,[E]))}}))}(this,e):Oe(e)?function(e,n){var r,i,a,o,u,s,c,E,l,f;return t.A((function(d){switch(d.j){case 1:return r=Ie(n),i=t.sH(n.entityKey),a=i.entityId,t.x(d,qt(e.j,n.entityKey,"musicTrack"),2);case 2:if(!(o=d.u)){u=void 0,d.Na(3);break}return t.x(d,qt(e.j,o.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:u=d.u;case 3:return s=u,o&&s?(t.pa(d,5),t.x(d,kr(e,a,s.addedTimestampMillis),7)):d.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));case 7:c=We("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",a,"playbackData",1,yi),t.ra(d,6);break;case 5:return(E=t.ta(d))instanceof Error&&"No data"===E.message?t.x(d,we(a,e.j,n,e.B),6):(l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof t.fw&&"QUOTA_EXCEEDED"===E.type&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),d.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,l,f)));case 6:return d.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,c?[c]:void 0))}}))}(this,e):ve(e)?function(e,n){var r,i;return t.A((function(a){switch(a.j){case 1:return r=Ie(n),t.pa(a,2),"!*$_ALL_ENTITIES_!*$"===(i=t.sH(n.entityKey).entityId)?t.x(a,je(e.j,n,e.B),5):t.x(a,we(i,e.j,n,e.B),5);case 5:t.ra(a,3);break;case 2:return t.ta(a),a.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return a.return(new Qe("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r))}}))}(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};var yi=[10];t.v(br,rr),br.prototype.qz=function(t){var e=rr.prototype.qz.call(this,t);return e.musicTrack=new Ur(t,this.j),e.musicPlaylist=new Lr(t,this.j),e},br.prototype.refreshAllStaleEntities=function(e,n){var r,i,a,o=this;return t.A((function(u){return 1==u.j?(i=r=[],a=i.concat,t.x(u,rr.prototype.refreshAllStaleEntities.call(o,e,n),2)):(r=a.call(i,u.u),u.return(r))}))},t.v(Hr,t.vO),t.k=Hr.prototype,t.k.create=function(){var e=this.player.V();t.tG(e)?this.j=new vr(e,this.player):t.bG(e)&&(this.j=new br(e,this.player))},t.k.Sj=function(){return!1},t.k.TK=function(e,n,r,i){var a=this;return t.A((function(t){return a.j?t.return(sr(a.j,e,n,r,i)):t.return(Promise.reject())}))},t.k.deleteAll=function(){return this.j.deleteAll()},t.k.JE=function(t){return this.j.JE(t)},t.k.refreshAllStaleEntities=function(t){return this.j.refreshAllStaleEntities(t)},t.k.EK=function(t){this.j.EK(t)},t.k.QA=function(t){return this.j.QA(t)},t.k.isOrchestrationLeader=function(){return this.j.isOrchestrationLeader()},t.uO("offline",Hr)}(_yt_player);